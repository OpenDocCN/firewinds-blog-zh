<html>
<head>
<title>Kubernetes Best Practice: How to (Correctly) Set Resource Requests and Limits</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>Kubernetes最佳实践:如何(正确地)设置资源请求和限制</h1>
<blockquote>原文：<a href="https://www.fairwinds.com/blog/how-to-correctly-set-resource-requests-and-limits#2022-12-16">https://www.fairwinds.com/blog/how-to-correctly-set-resource-requests-and-limits#2022-12-16</a></blockquote><div><span id="hs_cos_wrapper_post_body" class="hs_cos_wrapper hs_cos_wrapper_meta_field hs_cos_wrapper_type_rich_text" data-hs-cos-general-type="meta_field" data-hs-cos-type="rich_text"><p>管理Kubernetes时，我最大的烦恼之一就是工作负载没有资源请求和限制。对此我非常沮丧，于是我创建了一个开源项目Goldilocks，让设置初始资源请求和限制的过程变得更加容易。在这篇博客中，我将讨论Kubernetes正确设置资源请求和限制的最佳实践。</p>
<hr/>
<p>Kubernetes是一个动态系统，可以自动适应您的工作负载的资源利用率。Kubernetes有两个级别的缩放。每个单独的Kubernetes部署都可以使用水平Pod自动缩放器(HPA)进行自动缩放，而整个集群则使用集群自动缩放器进行缩放。HPA监视部署中各个单元的目标指标(通常是CPU或内存使用情况)，并根据需要添加或删除单元，以使该指标接近指定的目标。同时，Cluster Autoscaler处理集群本身的扩展。它会监视无法调度的单元，并向集群添加或删除节点以容纳这些单元。</p>
<p>Kubernetes支持这两种扩展操作的一个关键特性是能够为您的工作负载设置特定的资源请求和限制。通过对每个pod使用多少CPU和内存设置合理的限制和请求，您可以最大限度地提高基础架构的利用率，同时确保平稳的应用程序性能。为了最大化Kubernetes集群的有效利用率，正确设置资源限制和请求是非常重要的。对应用程序设置太低的限制会导致问题。例如，如果你的内存限制太低，Kubernetes一定会因为你违反了它的限制而杀死你的应用程序。同时，如果你把你的限制设置得太高，你会因为过度分配而浪费资源，这意味着你最终会有更高的账单。</p>
<p>虽然<a href="https://www.fairwinds.com/kubernetes-best-practices-comprehensive-white-paper"> <span> Kubernetes最佳实践</span> </a>规定您应该始终为您的工作负载设置资源限制和请求，但要知道每个应用程序使用什么值并不总是那么容易。结果，一些团队根本没有设置要求或限制，而另一些团队在初始测试时将它们设置得太高，然后永远不会正确。确保扩展操作正常工作的关键是调整每个工作负载的资源限制和请求，以便工作负载高效运行。</p>
<p>设置资源限制和请求是在Kubernetes集群上尽可能高效可靠地运行应用程序的关键。</p>
<h2>如何设置Kubernetes资源</h2>
<p>Fairwinds的开源项目<a href="https://www.fairwinds.com/goldilocks"> <span> Goldilocks </span> </a>帮助团队将资源分配到他们的Kubernetes部署中，并正确地校准这些资源。Goldilocks是一个Kubernetes控制器，它收集关于正在运行的pod的数据，并就如何设置资源请求和限制提供建议。它可以帮助组织了解资源使用、资源成本和效率方面的最佳实践。<a href="https://goldilocks.docs.fairwinds.com/"> <span>金凤花</span> </a>采用了VPA的Kubernetes垂直吊舱自动缩放器。它会考虑工作负载的历史内存和CPU使用情况，以及pod的当前资源使用情况，以便建议如何设置资源请求和限制。(虽然VPA实际上可以为您设置限制，但通常最好仅使用VPA引擎来提供建议。)本质上，该工具为名称空间中的每个部署创建一个VPA，然后查询该VPA以获取信息。</p>
<p>要查看这些建议，您必须使用kubectl来查询每个VPA对象，这对于大中型部署来说很快就会变得繁琐。这就是仪表板的用武之地。一旦你的VPA到位，建议将出现在金发女孩仪表板。</p>
<p>该控制面板根据您希望部署的服务质量(QoS)等级提供两种类型的建议:</p>
<ol>
<li aria-level="1">
<p><strong>保证</strong>，这意味着应用程序将被授予比其他工作负载更高的优先级，以保证可用资源。在这个类中，您将您的资源请求和限制设置为完全相同的值，这保证了容器所请求的资源在它被调度时是可用的。这个QoS等级通常非常适合最稳定的Kubernetes集群。</p>
</li>
<li aria-level="1">
<p><strong> Burstable </strong>，这意味着应用程序将获得最低水平的资源，但如果可用，将获得更多资源。本质上，您的资源请求低于您的限制。调度程序将使用该请求将pod放在一个节点上，但是随后pod可以使用更多的资源，直到它被终止或限制为止。当资源不足时，在决定删除哪些工作负载时，此QoS类别被授予较低的优先级。</p>
</li>
</ol>
<p>仪表板提供了保证和突发QoS类别的建议。在保证类中，我们建议将您的请求和限制设置为VPA“目标”字段。</p>
<p><em>注意:第三个QoS类别bestfortion表示不设置任何请求或限制，并且只有当所有其他请求都得到满足时，才会为应用程序分配资源。不建议使用BestEffort。</em></p>
<h2>为集群专门化实例组</h2>
<p>如果您对优化工作负载运行的实例感兴趣，可以使用不同的实例组类型和节点标签将工作负载导向特定的实例类型。</p>
<p>不同的业务系统通常有不同规模的资源需求，以及专门的硬件需求(如GPU)。Kubernetes中节点标签的概念允许您将标签放在所有不同的节点上。同时，可以将pod配置为使用特定的“节点选择器”来匹配特定的节点标签，这些标签决定了可以将pod调度到哪些节点上。通过利用带有适当标签的不同实例类型的实例组，您可以将您选择的云提供商提供的底层硬件与Kubernetes中的工作负载混合搭配。</p>
<p>如果您有不同规模、不同需求的工作负载，那么将这些工作负载放在不同的实例类型上，并使用标签将您的工作负载引导到这些不同的实例类型上，这在战略上和经济上都是有意义的。</p>
<p>Spot实例与这一想法密切相关。大多数组织都熟悉按需或在固定期限内按保留条款支付实例费用。但是，如果您有可能被中断的工作负载，您可能希望考虑使用spot实例。这些实例类型允许您以显著的折扣利用云提供商的剩余容量—当对常规按需实例的需求增加时，所有这些都有实例被终止的风险。</p>
<p>如果您的一些业务工作负载可以承受随机实例终止的风险，那么您可以使用相同的节点标记概念来专门将这些工作负载调度到这些类型的实例组上，从而节省大量成本。</p>
<h2>如何启用Kubernetes资源推荐</h2>
<p>Goldilocks是Fairwinds Insights  部署来提供工作负载效率和性能优化的工具之一。借助Fairwinds Insights，Goldilocks可以跨多个集群部署，因此团队可以在单一控制台中获得信息。Fairwinds Insights为Goldilocks增加了数据和建议，包括潜在的成本节约。出现的控制面板包括名称空间和部署的列表，以及平均总成本和成本建议。</p>
<blockquote>
<p>Fairwinds Insights可供免费使用。你可以在 这里<a href="https://www.fairwinds.com/coming-soon"> <span>报名。</span></a></p>
</blockquote>
<p>许多组织将其CPU和内存请求和限制设置得太高，因此当他们应用Fairwinds Insights的建议时，他们能够在更少的Kubernetes工作节点上放置更多的pod。启用集群自动缩放后，任何多余的节点在未使用时都会被删除，从而节省时间和金钱。</p>
<p>使用像Fairwinds Insights这样的软件或像Goldilocks这样的开源工具，开发人员可以通过自动化推荐过程来消除猜测。反过来，它为您打开了提高集群效率和减少云支出的大门。</p>
<p><span class="hs-cta-wrapper" id="hs-cta-wrapper-34aa4987-a1f9-438a-a145-d7d82d5c479a"><span class="hs-cta-node hs-cta-34aa4987-a1f9-438a-a145-d7d82d5c479a" id="hs-cta-34aa4987-a1f9-438a-a145-d7d82d5c479a"><a href="https://cta-redirect.hubspot.com/cta/redirect/2184645/34aa4987-a1f9-438a-a145-d7d82d5c479a"><img class="hs-cta-img" id="hs-cta-img-34aa4987-a1f9-438a-a145-d7d82d5c479a" src="../Images/7c86296320eb01b215d8e2755e9c5b9d.png" alt="Use Fairwinds Insights for Free Security, Cost and Developer Enablement In One" data-original-src="https://no-cache.hubspot.com/cta/default/2184645/34aa4987-a1f9-438a-a145-d7d82d5c479a.png"/></a></span>T6】</span></p></span></div>    
</body>
</html>