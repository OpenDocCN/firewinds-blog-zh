<html>
<head>
<title>Kubernetes Controllers Basics</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>Kubernetes控制器基础知识</h1>
<blockquote>原文：<a href="https://www.fairwinds.com/blog/kubernetes-controllers#2022-05-17">https://www.fairwinds.com/blog/kubernetes-controllers#2022-05-17</a></blockquote><div><span id="hs_cos_wrapper_post_body" class="hs_cos_wrapper hs_cos_wrapper_meta_field hs_cos_wrapper_type_rich_text" data-hs-cos-general-type="meta_field" data-hs-cos-type="rich_text"><p>如果你对Kubernetes 不熟悉，你首先要熟悉的概念之一就是控制器。大多数Kubernetes用户不直接创建Pods相反，他们创建一个部署、CronJob、StatefulSet或其他控制器来为他们管理pod。</p>

<h2><strong>控制器基础知识</strong></h2>
<p>首先，这里有一些控制器的基础知识。Kubernetes文档使用了一个例子，控制器就像你的恒温器。刻度盘的位置是它想要的状态，当前的温度是它的实际状态，恒温器不断地加热或散热以保持两者同步。这就是Kubernetes控制器的工作方式——它是一个循环，监视集群的状态，并根据需要进行更改，始终保持您想要的状态。</p>
<p>控制器可以跟踪许多对象，包括:</p>
<ul>
<li>哪些工作负载正在运行，在哪里运行</li>
<li>这些工作负载可用的资源</li>
<li>围绕工作负载行为的策略(重启、升级、容错)</li>
</ul>
<p>当控制器注意到实际状态和期望状态之间的差异时，它将向Kubernetes API服务器发送消息，以进行任何必要的更改。</p>
<h2><strong>控制器的类型</strong></h2>
<p>在我们基本的Kubernetes概念中，我们强调了许多Pod控制器，包括以下内容。然后，我们将深入研究四个最常用的控制器。</p>
<ul>
<li>replica set——replica set创建一组稳定的单元，所有单元都运行相同的工作负载。你几乎不会直接创建它。</li>
<li>部署-部署是在Kubernetes上获取应用程序的最常见方式。它维护了一个具有所需配置的副本集，以及一些用于管理更新和回滚的附加配置。</li>
<li>stateful set-stateful set用于管理具有持久存储的有状态应用程序。Pod名称是永久性的，在重新计划时会保留(app-0、app-1)。存储保持与替换机架相关联，当删除机架时，卷仍然存在。</li>
<li>作业-作业创建一个或多个短期pod，并期望它们成功终止。</li>
<li>cron job——cron job按计划创建作业。</li>
<li>daemon set-daemon set确保所有(或一些)节点运行一个Pod的副本。随着节点添加到集群中，单元也会添加到其中。随着节点从集群中移除，这些pod将被垃圾收集。常见于CNI、监控代理、代理等系统进程。</li>
</ul>
<h2><strong>复制集</strong></h2>
<p>副本集是一组没有唯一标识的多个相同的pod。复制集旨在满足两个要求:</p>
<ul>
<li>容器是短暂的。当他们失败时，我们需要他们的吊舱重新启动。</li>
<li>我们需要运行一定数量的pod。如果一个被终止或失败，我们需要新的豆荚被激活。</li>
</ul>
<p>副本集确保指定数量的Pod副本在任何给定时间运行。尽管您可能永远不会直接创建副本集，但这是保持Kubernetes基础设施正常运行的重要部分。</p>
<h2><strong>部署</strong></h2>
<p>像复制集一样，部署是一组没有唯一标识的多个相同的pod。但是，部署比复制集更容易升级和修补。用户可以配置推出新版本部署的策略，从而可以在最短的停机时间内推出变更。</p>
<p>例如，我们可以选择滚动更新策略。然后，当我们更新部署时，将会在现有副本集旁边创建第二个副本集，随着新副本集中更多的pod准备就绪，一些副本集将会从旧副本集中删除，直到旧副本集为空并且可以删除。我们甚至可以设置像<a href="https://kubernetes.io/docs/concepts/workloads/controllers/deployment/#rolling-update-deployment"> maxUnavailable和maxSurge </a>这样的参数来控制这种切换的机制。</p>
<h2><strong>状态设置</strong></h2>
<p>虽然部署管理无状态应用程序，但有状态集对于需要以下一项或多项功能的应用程序很有价值:</p>
<ul>
<li>稳定、唯一的网络标识符</li>
<li>稳定、持久的存储</li>
<li>有序、优雅的部署和扩展</li>
<li>有序的自动滚动更新</li>
</ul>
<p>StatefulSet为它管理的每个Pod保留一个唯一的标识。每当它需要重新安排那些豆荚的时候，它使用相同的身份。</p>
<p>当运行Cassandra、MongoDB、MySQL、PostgreSQL或任何其他利用持久存储的工作负载时，建议使用StatefulSets。它们可以在伸缩和更新事件期间帮助维护状态，对于维护高可用性特别有用。</p>
<h2><strong>工作</strong></h2>
<p>作业是短期工作负载，可用于执行单个任务。作业将简单地创建一个或多个pod，并等待这些pod成功完成。工作有助于做以下事情:</p>
<ul>
<li>运行数据库迁移</li>
<li>执行维护任务</li>
<li>旋转原木</li>
</ul>
<p>作业还可以并行运行多个pod，为您提供一些额外的吞吐量。</p>
<h2><strong> CronJob </strong></h2>
<p>CronJobs只是按照用户定义的计划运行作业。您可以使用<a href="https://en.wikipedia.org/wiki/Cron"> cron语法</a>提供调度，CronJob控制器将在每次调度需要时自动创建一个作业。</p>
<p>CronJob控制器还允许您指定可以并发运行多少个作业，以及保留多少个成功或失败的作业用于日志记录和调试。</p>
<hr/>
<h2><strong>总结</strong></h2>
<p>Kubernetes控制器允许您在集群中运行和管理您的应用程序，并且是您需要理解的核心概念之一，以便在Kubernetes中获得成功。</p>
<p>当然，在您拥有一个生产就绪的集群之前，您还需要更多。如果您正在寻找创建一个完全可操作的Kubernetes集群，您可以<a href="https://www.fairwinds.com/blog/making-kubernetes-fully-operational">查看我们关于主题</a>的博客帖子。或者，如果您正在学习Kubernetes，请查看我们的<a href="https://www.fairwinds.com/blog/tag/how-to-kube" target="_blank" rel="noopener"> How to Kube </a>系列，该系列展示了Kubernetes在概念、工具、安全性等方面的最佳实践。</p>
<p><span class="hs-cta-wrapper" id="hs-cta-wrapper-d329e036-9905-4715-85b8-31a98b50623c"><span class="hs-cta-node hs-cta-d329e036-9905-4715-85b8-31a98b50623c" id="hs-cta-d329e036-9905-4715-85b8-31a98b50623c"><a href="https://cta-redirect.hubspot.com/cta/redirect/2184645/d329e036-9905-4715-85b8-31a98b50623c"><img class="hs-cta-img" id="hs-cta-img-d329e036-9905-4715-85b8-31a98b50623c" src="../Images/90e93a941f22f2087c3a229a91ea6c10.png" alt="Fairwinds Insights is Available for Free Sign Up Now" data-original-src="https://no-cache.hubspot.com/cta/default/2184645/d329e036-9905-4715-85b8-31a98b50623c.png"/></a></span>T6】</span></p></span></div>    
</body>
</html>