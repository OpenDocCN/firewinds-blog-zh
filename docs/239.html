<html>
<head>
<title>GoNoGo Checks Kubernetes Add-ons Before an Upgrade</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>GoNoGo在升级前检查Kubernetes附加组件</h1>
<blockquote>原文：<a href="https://www.fairwinds.com/blog/gonogo-checks-kubernetes-add-ons#2022-08-09">https://www.fairwinds.com/blog/gonogo-checks-kubernetes-add-ons#2022-08-09</a></blockquote><div><span id="hs_cos_wrapper_post_body" class="hs_cos_wrapper hs_cos_wrapper_meta_field hs_cos_wrapper_type_rich_text" data-hs-cos-general-type="meta_field" data-hs-cos-type="rich_text"><p>在GKE或AKS这样的服务上部署第一个Kubernetes集群非常简单，但是当你想实际使用Kubernetes时，附加组件就变得很重要。</p>
<p>附加组件扩展了Kubernetes的功能。一些例子包括<a href="https://github.com/kubernetes-sigs/metrics-server" rel="noopener" target="_blank">度量服务器</a>、<a href="https://cert-manager.io/" rel="noopener" target="_blank">证书管理器</a>、<a href="https://github.com/kubernetes/autoscaler/tree/master/cluster-autoscaler" rel="noopener" target="_blank">集群自动缩放器</a>。与任何软件一样，附加组件的挑战在于它们需要升级。</p>

<p>每次需要进行附加升级时，都需要进行大量检查，以确保最新版本与您的集群兼容，并且没有重大更改。这个过程非常耗时，尤其是当您管理多个集群时。</p>
<p>这就是Fairwinds发布其最新开源工具<a href="https://github.com/FairwindsOps/gonogo/tree/main" rel="noopener" target="_blank"> GoNoGo </a>的原因，该规范可用于定义然后发现与Helm一起安装的附加组件是否可以安全升级。</p>
<h2>GoNoGo如何工作</h2>
<p>监控附加升级是管理集群的一部分。在本例中，我们将讨论证书管理器的升级。SRE将意识到即将到来的或新的证书管理器升级。SRE需要通过查看文档和发行说明来确定是否需要升级。</p>
<p>GoNoGo依靠用户用Helm管理和升级附加组件。一旦您决定要进行升级，您将在一个名为bundle spec的YAML文件中绘制一些字段。这些字段将用于设置参数，这些参数将根据集群和舵图信息进行评估，以确定该插件的升级可信度。</p>
<p>例如:</p>
<ul>
<li aria-level="1">
<p>您可能有一个只能在Kubernetes及以上版本上运行的版本</p>
</li>
<li aria-level="1">
<p>您可能希望检查集群中的某些API是否可用</p>
</li>
<li aria-level="1">
<p>您可能希望检查您的清单是否指定了适用于您要升级到的版本的API版本</p>
</li>
</ul>
<p>所有这些信息将被捆绑在一个YAML文件中，并输入到GoNoGo。</p>
<p>然后运行GoNoGo，并带有一个指向这个包文件的标志。GoNoGo会将您的捆绑包规范中的附加组件列表与您的集群中部署的Helm版本进行比较，并针对已经成功部署到您的集群的附加组件运行您指定的检查。然后，GoNoGo将使用图表清单、上游repo和集群清单的组合来运行您的包规范中的各种检查。</p>
<h2>捆绑包中的OPA和JSON</h2>
<p>在您的包中，您还可以设置定制的OPA检查，在清单中查找注释和字段之类的东西。GoNoGo将运行OPA检查舵图的单个YAML文件，以及您在“resources”键下的包中指定的任何对象。</p>
<p>它还运行json模式验证。GoNoGo可以根据存储在repo中的上游values.schema.json文件进行验证，或者您可以提供自己的内嵌模式。例如，您的架构可以指定它将检查imagePullPolicy是否设置为Always。</p>
<h2>为什么要用GoNoGo？</h2>
<p>虽然您仍然需要监视附加升级、查看文档并签入规范中的更改，但GoNoGo可以帮助您节省手动查看集群中所有对象的时间。</p>
<p>例如，如果cert-manager不同意一个注释，您将需要查看将要从中提取的上游舵图，并检查舵图是否已经更新了它的清单。你还需要进入你的集群，做一个导航<code>get manifest</code>，逐个查看你所有的清单，确保它们也有正确的注释。GoNoGo为你做这个。因为GoNoGo会自动完成这项工作，所以在升级过程中丢失文件/人为错误的风险更小。</p>
<p>附加升级的最大风险是，因为它们是在集群范围内使用的，如果出现问题，它们可能会对您的集群产生深远的影响。影响范围将取决于附加组件。对于Metric Server，可能没什么大不了的。但是，如果由于没有正确指定入口类名而错过了nginx入口插件，它可能无法传递流量，从而导致不必要的停机。类似地，如果您有一个损坏的cert-manager安装，那么当您试图解决这个问题时，您将无法为工作负载生成新的cert。因此，虽然群集可能没有关闭，但它可能会影响服务。</p>
<p>如果您正在升级附加组件，请查看<a href="https://github.com/FairwindsOps/gonogo/tree/main" rel="noopener" target="_blank"> GoNoGo </a>。</p>
<h3>资源</h3>
</span></div>    
</body>
</html>