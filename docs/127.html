<html>
<head>
<title>Goldilocks: An Open Source Tool for Recommending Resource Requests</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>Goldilocks:一个推荐资源请求的开源工具</h1>
<blockquote>原文：<a href="https://www.fairwinds.com/blog/introducing-goldilocks-a-tool-for-recommending-resource-requests#2023-01-10">https://www.fairwinds.com/blog/introducing-goldilocks-a-tool-for-recommending-resource-requests#2023-01-10</a></blockquote><div><span id="hs_cos_wrapper_post_body" class="hs_cos_wrapper hs_cos_wrapper_meta_field hs_cos_wrapper_type_rich_text" data-hs-cos-general-type="meta_field" data-hs-cos-type="rich_text"><p id="3267" class="fm fn av bn fo b fp fq fr fs ft fu fv fw fx fy fz" data-selectable-paragraph="">Fairwinds的客户最常向我提出的一个问题是“我们如何知道如何设置我们的资源请求和限制？”今天我们开源了一个工具，希望能在这方面给大家一点帮助。Goldilocks是一个Kubernetes控制器，它提供了一个指示板，给出了关于如何设置资源请求的建议。</p>

<p id="68b5" class="fm fn av bn fo b fp fq fr fs ft fu fv fw fx fy fz" data-selectable-paragraph="">为了提供建议，我们使用了<span> </span> <a href="https://github.com/kubernetes/autoscaler/tree/master/vertical-pod-autoscaler" class="ax ci ga gb gc gd" target="_blank" rel="noopener">垂直吊舱</a> <span> </span> (VPA)。VPA控制器堆栈包含一个建议引擎，它会考虑到您的pod的当前资源使用情况，以便提供指导。VPA的主要目标是实际上为你设置这些，但我们目前对它如何做到这一点并不满意；更具体地说，我们喜欢运行水平吊舱自动缩放，这并不适合VPA。相反，我们只是使用VPA提供的推荐引擎，就如何设置您的资源请求和限制向您提供良好的建议。</p>
<p id="9fb2" class="fm fn av bn fo b fp fq fr fs ft fu fv fw fx fy fz" data-selectable-paragraph="">我们利用VPA推荐引擎的方式很简单。我们在集群中运行一个控制器，监视标有<span> </span> <code class="ge gf gg gh gi b">goldilocks.fairwinds.com/enabled=true</code>的名称空间。在这些启用的名称空间中，我们查看每个部署对象并创建相应的VPA对象。VPA设置为<span> </span> <code class="ge gf gg gh gi b">Mode: Off</code> <span> </span>，并不实际修改您的资源请求和限制；它只是坐在那里，提供一个建议。这本身就很酷，但是为了查看这些推荐，你必须使用<span> </span> <code class="ge gf gg gh gi b">kubectl</code> <span> </span>来查询每一个VPA对象。对于大中型部署，这可能会非常繁琐。这就是仪表板的用武之地。</p>
<p id="a0b3" class="fm fn av bn fo b fp fq fr fs ft fu fv fw fx fy fz" data-selectable-paragraph="">“金发女孩仪表板”直观地展示了VPA建议。现在，您可以访问集群中的服务并查看两种类型的建议，这取决于您希望部署的QoS等级。仪表板如下所示:在</p>
<figure class="gk gl gm gn go cs cn co paragraph-image">

<figcaption class="bq at hd he hf cp cn co hg hh ar as" data-selectable-paragraph=""><em>Goldilocks Dashboard Preview</em></figcaption>
</figure>
<p id="87a0" class="fm fn av bn fo b fp fq fr fs ft fu fv fw fx fy fz" data-selectable-paragraph="">如果你现在想自己安装金发女孩，请前往https://github.com/FairwindsOps/goldilocks<span/><a href="https://github.com/FairwindsOps/goldilocks" class="ax ci ga gb gc gd" target="_blank" rel="noopener"/><span/>寻求指导。否则继续阅读，看看一些常见问题。</p>
<h2 id="2243" class="hi hj av bn ar hk hl hm hn ho hp hq hr hs ht hu hv" data-selectable-paragraph="">我如何安装金发女孩？</h2>
<p id="705f" class="fm fn av bn fo b fp hw fr hx ft hy fv hz fx ia fz" data-selectable-paragraph="">安装金发女孩最简单的方法是使用我们的<span> </span> <a href="https://github.com/FairwindsOps/charts/tree/master/stable/goldilocks" class="ax ci ga gb gc gd" target="_blank" rel="noopener">舵轮图</a>。您可以通过运行以下命令来实现:</p>
<pre class="gk gl gm gn go ib ic id"><span id="38ff" class="hi hj av bn gi b at ie if l ig" data-selectable-paragraph="">helm repo add fairwinds-stable https://charts.fairwinds.com/stable<br/>helm install --name goldilocks --namespace goldilocks --set <br/></span>installVPA=true fairwinds-stable/goldilocks</pre>
<p id="5984" class="fm fn av bn fo b fp fq fr fs ft fu fv fw fx fy fz" data-selectable-paragraph="">这将安装VPA(来自他们的回购)、金发姑娘控制器和金发姑娘仪表板。<br/> <br/>现在您可以通过端口转发访问仪表板:</p>
<pre class="gk gl gm gn go ib ic id"><span id="b616" class="hi hj av bn gi b at ie if l ig" data-selectable-paragraph="">kubectl -n goldilocks port-forward svc/goldilocks-dashboard 8080:80</span></pre>
<p id="e776" class="fm fn av bn fo b fp fq fr fs ft fu fv fw fx fy fz" data-selectable-paragraph="">其他选项可在<span> </span> <a href="https://github.com/FairwindsOps/charts/tree/master/stable/goldilocks" class="ax ci ga gb gc gd" target="_blank" rel="noopener">图表</a> <span> </span>和<span> </span> <a href="https://github.com/FairwindsOps/goldilocks" class="ax ci ga gb gc gd" target="_blank" rel="noopener">金发女孩储存库</a>中找到。</p>
<h2 id="fb3b" class="hi hj av bn ar hk hl hm hn ho hp hq hr hs ht hu hv" data-selectable-paragraph="">如果我想从仪表板中排除容器该怎么办？</h2>
<p id="ed4e" class="fm fn av bn fo b fp hw fr hx ft hy fv hz fx ia fz" data-selectable-paragraph="">这是我们对金发女孩的第一次升级，主要是因为sidecar代理模式。我们经常看到每个单元都有一个边车的集群，例如Istio或Linkerd2边车。您可能不想看到这些容器的资源建议，因为我们可能控制这些值，也可能无法控制这些值。有两种方法可以排除这些容器。</p>
<p id="116b" class="fm fn av bn fo b fp fq fr fs ft fu fv fw fx fy fz" data-selectable-paragraph="">第一种方法是全局的，可以通过运行带有标志<span> </span> <code class="ge gf gg gh gi b">--exclude-containers "istio-proxy,linkerd-proxy"</code>的仪表板来设置。这是在舵图安装中默认设置的。</p>
<p id="2d5c" class="fm fn av bn fo b fp fq fr fs ft fu fv fw fx fy fz" data-selectable-paragraph="">第二种方法是使用部署本身的标签来排除每个部署的容器:<span> </span> <code class="ge gf gg gh gi b">goldilocks.fairwinds.com/exclude-containers=linkerd-proxy,istio-proxy</code>。</p>
<h2 id="170d" class="hi hj av bn ar hk hl hm hn ho hp hq hr hs ht hu hv" data-selectable-paragraph="">这个QoS类别是什么？</h2>
<p id="61ba" class="fm fn av bn fo b fp hw fr hx ft hy fv hz fx ia fz" data-selectable-paragraph="">如果您还不熟悉它，QoS Class指的是设置资源请求和限制的不同方式。有两个是我们关心的，还有一个几乎不应该使用。你可以在Kubernetes文档中阅读关于它们的详细信息<span> </span> <a href="https://kubernetes.io/docs/tasks/configure-pod-container/quality-service-pod/" class="ax ci ga gb gc gd" target="_blank" rel="noopener">，但是我将在这里对它们进行总结。</a></p>
<p id="368b" class="fm fn av bn fo b fp fq fr fs ft fu fv fw fx fy fz" data-selectable-paragraph=""><strong class="fo ih">保证</strong> <span> </span> —这是我最喜欢的QoS类别，因为它通常适用于最稳定的Kubernetes集群。在这个类中，您将您的资源请求和限制设置为完全相同的值，这保证了容器所请求的资源在它被调度时是可用的。</p>
<p id="a892" class="fm fn av bn fo b fp fq fr fs ft fu fv fw fx fy fz" data-selectable-paragraph=""><strong class="fo ih">可突发</strong> <span> </span> —这意味着您的资源请求低于您的限制。本质上，调度程序将使用请求将pod放在一个节点上，但是随后pod可以使用更多的资源，直到它被终止或限制为止。</p>
<p id="f6d6" class="fm fn av bn fo b fp fq fr fs ft fu fv fw fx fy fz" data-selectable-paragraph=""><strong class="fo ih"> BestEffort </strong> <span> </span> —不设置任何资源请求或限制。我们不建议你这么做。</p>
<p id="5818" class="fm fn av bn fo b fp fq fr fs ft fu fv fw fx fy fz" data-selectable-paragraph="">Goldilocks仪表板将为您提供有保证的和可突发的QoS类别的建议。这些是由VPA建议字段中的不同值生成的。在保证类中，我们建议您将您的请求和限制设置为VPA“目标”字段。通常，我们将该值与水平Pod自动缩放器一起使用，以允许我们的应用程序进行缩放。突发类推荐来自VPA下界和上界油田。您可以在他们的回购中了解更多关于来自VPA <span> </span> <a href="https://github.com/kubernetes/autoscaler/blob/master/vertical-pod-autoscaler/pkg/recommender/README.md#implmentation" class="ax ci ga gb gc gd" target="_blank" rel="noopener">的推荐人的信息。</a></p>
<h3 id="1ec5" class="ii hj av bn ar hk ij ik il im in io ip iq ir is it" data-selectable-paragraph="">感谢阅读</h3>
<p id="dde7" class="fm fn av bn fo b fp hw fr hx ft hy fv hz fx ia fz" data-selectable-paragraph="">如果您有问题(或有如何改进的想法！)我们希望收到您的来信。联系我们的最佳方式是通过<span> </span> <a href="https://github.com/FairwindsOps/goldilocks" class="ax ci ga gb gc gd" target="_blank" rel="noopener"> Github </a>上的请求或问题。感谢阅读！</p></span></div>    
</body>
</html>