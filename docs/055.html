<html>
<head>
<title>3 Kubernetes Guardrails Every Ops Team Needs</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>每个运营团队都需要3个Kubernetes护栏</h1>
<blockquote>原文：<a href="https://www.fairwinds.com/blog/3-kubernetes-guardrails-every-team-needs#2023-01-10">https://www.fairwinds.com/blog/3-kubernetes-guardrails-every-team-needs#2023-01-10</a></blockquote><div><span id="hs_cos_wrapper_post_body" class="hs_cos_wrapper hs_cos_wrapper_meta_field hs_cos_wrapper_type_rich_text" data-hs-cos-general-type="meta_field" data-hs-cos-type="rich_text"><p data-type="unstyled" data-id="0c6b9e60-7453-4ea8-8d9d-d1e737fa7819">在真正的DevOps环境中，运营和开发人员共同负责Kubernetes环境。运营部门确保核心平台平稳运行，而开发部门负责打包他们的应用程序并将其发送到集群中。</p>

<p data-type="unstyled" data-id="57d5de9d-b4b9-4897-8cc5-b4598a2be53b">假设运营团队是一个经验丰富的Kubernetes工程师团队，那么构建一个安全、高效、可靠的集群并不难。但是一旦您让开发人员与集群进行交互，事情就会变得非常棘手。开发人员通常希望专注于代码和特性，并因此得到回报。基础设施往往是事后才想到的——他们只是想“让它运转起来”</p>
<p data-type="unstyled" data-id="4af3a829-3345-4051-89f1-32b5f4b0aa54">这取决于运营团队将正确的<a data-type="LINK" data-url="https://www.fairwinds.com/blog/what-are-kubernetes-guardrails" href="https://www.fairwinds.com/blog/what-are-kubernetes-guardrails"><strong data-type="bold">Kubernetes</strong><strong data-type="bold">guardrails</strong></a>放置到位，以引导他们的开发团队走向最佳实践和策略遵从。这不仅防止了安全漏洞和重大停机等关键问题；它还帮助开发团队更快、更自信地交付，知道他们的更改在进入生产之前会被检查是否有问题。</p>
<p data-type="unstyled" data-id="98588907-9916-4cbe-b9ac-53b7f21fb3eb">让我们来看看三个主要的guardrails Ops团队应该整合到一起，以帮助开发团队在面向DevOps的Kubernetes环境中取得成功。</p>
<h2 data-type="header-two" data-id="216f944a-4574-49a6-9cd5-1708c3f971c8">RBAC</h2>
<p data-type="unstyled" data-id="90fe2961-9ebb-495a-a89b-16548194e5e0">任何DevOps驱动的组织应该实现的第一个护栏是基于角色的访问控制，或RBAC。RBAC确切地决定了在您的环境中允许每个用户或进程采取什么操作。</p>
<p data-type="unstyled" data-id="b0643f01-2b92-4f13-bc6a-69b253c4521b">至少，您的组织应该针对不同的角色使用三种独特的角色:</p>
<ul>
<li data-id="e29dcaf5-fab9-4e3e-9e6c-2eda13e3389a">集群管理员——这是最高级别的权限，可以对集群进行任何更改。这个角色应该只对少数关键人物开放，并且只在“打碎玻璃”的紧急情况下使用。</li>
<li data-id="12947fb0-1bb1-4c31-952f-f59c22a0ff7c">Ops Engineer -该角色应该有广泛的权限来修改集群，而没有什么限制。为了完成他们的工作，操作工程师需要一个在其他人手中可能是危险的访问级别。但是，您可能想要削减权限，比如<code data-type="code">create pods/exec</code>或<code data-type="code">get secrets</code></li>
<li data-id="723ad71d-b077-4318-bcc1-aa945f0fc092">开发者——这个角色应该有最低限度的权限。它通常是一个只读角色，允许开发人员查看其工作负载的日志和状态。角色也可以绑定到特定的名称空间，这样一个开发人员就不能查看另一个团队的日志。</li>
</ul>
<p data-type="unstyled" data-id="58d7d1d9-53ed-4404-bf2c-51e68e6df8a9">此外，您应该创建一个“应用程序部署”角色，该角色可以在持续部署流程中使用。这将需要比开发人员角色更多的权限(因为它必须进行修改)，但可以被限制做类似修改<code data-type="code">kube-system</code>名称空间的事情。</p>
<p data-type="unstyled" data-id="0e6c31fc-ecd1-4d19-a0ba-9a4751cae11b">RBAC是实施护栏的良好开端。如果做得好，它可以成功地控制非专家(甚至是疲惫的专家)的一些诚实错误的爆炸半径！)可能会使。但这还不够，开发人员仍然可以自由支配他们的名称空间，并且可以很容易地错误配置他们的工作负载，从而造成安全漏洞、大量资源浪费或非常不可靠的应用程序。</p>
<h2 data-type="header-two" data-id="7aa3e65c-17ba-41d3-84c2-8919e09b23fe">政策</h2>
<p data-type="unstyled" data-id="34ad0141-9681-474f-8c43-db29ef4612f2">运营团队必须设置防护栏，以确保所有应用程序工作负载都得到正确配置。Kubernetes提供了很多方法来调整应用程序的安全配置文件、资源使用和弹性，缺省值通常是不够的。</p>
<p data-type="unstyled" data-id="640fb888-6540-41c8-a690-a6dbda148d7f">例如，默认情况下，每个工作负载都允许<a data-type="LINK" data-url="https://www.fairwinds.com/blog/how-to-identify-kubernetes-pods-running-root" href="https://www.fairwinds.com/blog/how-to-identify-kubernetes-pods-running-root">作为根用户</a>运行。在容器化的环境中，这看起来可能是安全的，但是在某些情况下，攻击者能够逃离容器并访问主机。如果容器以根用户身份运行，攻击者就可以以根用户身份访问主机节点，从而造成严重破坏。确保所有应用程序以非root用户身份运行是缩小攻击面的一种简单方法。</p>
<p data-type="unstyled" data-id="039f9681-1f16-425b-b83b-da563593d8a3">类似地，Kubernetes将很乐意允许您部署一个没有内存和CPU设置或者没有健康探测的工作负载。但是，如果您想要零停机部署和合理的自动伸缩行为，就必须设置这些选项。</p>
<p data-type="unstyled" data-id="ba2b0547-2291-4c83-8188-a7fa31014e05">对于面向用户的应用程序，您的组织至少应该实施以下策略:</p>
<ul>
<li data-id="59a30d6b-7d3b-41b0-92f7-59f35ab5e971">指定内存和CPU设置(请求和限制)</li>
<li data-id="792a5aec-fb00-46ff-8834-ba161fe145d2">指定活动和就绪探测器</li>
<li data-id="c620227c-5cff-4881-9e43-8a2504132a1e">加强安全性:</li>
<ul>
<li data-id="a74d2c03-7217-4411-9cd2-58abd512ed0c">不允许以root用户身份运行、以特权身份运行和特权提升</li>
<li data-id="16d66ab0-6c6f-422e-8520-9a9fb9f45376">不要添加任何额外的<a data-type="LINK" data-url="https://docs.docker.com/engine/reference/run/#runtime-privilege-and-linux-capabilities" data-entity-id="7fa5eb9a-c0cb-4160-80f7-967c9f365802" href="https://docs.docker.com/engine/reference/run/#runtime-privilege-and-linux-capabilities" rel="noopener" target="_blank"> Linux功能</a></li>
<li data-id="0e043f7f-99b1-4a6e-8d75-f57aca50eeca">不要设置主机IPC、主机PID或主机网络</li>
</ul>
</ul>
<p data-type="unstyled" data-id="70611c95-16eb-44d0-b44b-862c17314282">您可能还需要一些额外的实施策略，如:</p>
<ul>
<li data-id="066d6ed2-f482-4b61-828f-3e1996808138">具体的标记方案(例如，确保每个工作负载都有一个<code data-type="code">costCenterCode</code>)</li>
<li data-id="fec0dc6c-6357-437d-9eff-61ab254090b6">放弃所有默认的Linux功能</li>
<li data-id="7924ea86-0321-4891-8183-d56ea902c759">确保所有工作负载都有横向Pod自动扩展和Pod中断预算</li>
<li data-id="b3f6c0e3-6226-4e45-b314-b7601ea39540">剔除具有已知CVE的容器</li>
</ul>
<p data-type="unstyled" data-id="53c332a7-74cf-4e99-90a2-6519256164ea">这些策略应该作为准入控制器来执行。这将扫描对Kubernetes集群的所有修改，并拒绝任何违反策略的修改。您可能还想让运营团队在某些情况下有所例外。</p>
<h2 data-type="header-two" data-id="bcd2111f-7e7b-4623-a6be-32cd5f3af9bc">基础设施代码扫描</h2>
<p data-type="unstyled" data-id="cdb4eb27-2a69-41ce-88eb-caa900e8a474">有一个准入控制器是一个很好的开始，但是很快你会发现开发团队抱怨这降低了他们的速度。这与我们想要的好的Kubernetes护栏正好相反！</p>
<p data-type="unstyled" data-id="730480db-80bd-46b5-9966-8f169cd16fb8">问题是，开发人员只有在将他们的更改合并到他们的基础设施即代码(IaC)存储库的主要分支之后，才能从准入控制器<i data-type="italic">获得反馈。这意味着，如果出现问题，他们将不得不返回，进行更多的更改，然后再试一次。这个循环会很慢，很累。</i></p>
<p data-type="unstyled" data-id="7067e34e-c4f3-4999-a69f-0641a202296f">相反，作为持续集成(CI)过程的一部分，在准入控制器中实施的相同策略也应该在基础设施即代码上实施。这样，开发人员无论何时发出拉请求，都会得到反馈，在变更合并到主分支之前<i data-type="italic">。开发人员可以快速修复其分支的任何问题，并自信地合并，因为他们知道如果CI管道通过，准入控制器将接受部署。</i></p>
<p data-type="unstyled" data-id="063da9bd-8537-41f5-bdb5-39442ea6800c">幸运的是，许多开源和商业Kubernetes策略工具在这方面做得很好。特别是，Fairwinds开源项目<a data-type="LINK" data-url="https://polaris.docs.fairwinds.com/" href="https://polaris.docs.fairwinds.com/"> Polaris </a>能够针对基础设施即代码文件以及准入控制器运行其策略(内置和自定义策略)。一些口味的<a data-type="LINK" data-url="https://github.com/open-policy-agent/opa" data-entity-id="8f59c2da-0366-472e-975d-5d71452d5549" href="https://github.com/open-policy-agent/opa" rel="noopener" target="_blank"> OPA </a>也能做到这一点。</p>
<h2 data-type="header-two" data-id="2bfbe881-6c9d-421e-9066-f71aeceb1d63">Kubernetes护栏助您安全快速移动</h2>
<p data-type="unstyled" data-id="a245e0f5-322e-4299-9984-90cf4c4fa749">对于任何运营Kubernetes的组织来说，合适的护栏都是必不可少的。有了正确的RBAC、准入策略和<a data-type="LINK" data-url="https://www.fairwinds.com/blog/why-infrastructure-as-code-kubernetes" href="https://www.fairwinds.com/blog/why-infrastructure-as-code-kubernetes"> IaC扫描</a>,开发团队可以更快地交付，而运营团队可以确保他们的集群保持安全、高效和可靠。</p>
<p data-type="unstyled" data-id="c13958db-9384-4577-8ad3-279773515050">如果您希望在您的组织中实施Kubernetes guardrails，请查看<a data-type="LINK" data-url="https://www.fairwinds.com/insights" data-entity-id="dbc18e1c-f663-4348-8241-4cc6ebf2b3fc" href="https://www.fairwinds.com/insights"> Fairwinds Insights </a>。它附带了100多种内置策略(外加OPA和Polaris自定义策略),可以在整个开发生命周期中强制执行，它们可以在IaC上运行，在准入控制中运行，或者按计划扫描您的实时环境。策略甚至可以定制，并限定于特定的集群、命名空间、标签等。</p>
<blockquote>
<p data-type="unstyled" data-id="c13958db-9384-4577-8ad3-279773515050">借助Fairwinds Insights  ，在一个平台中为<a href="https://www.fairwinds.com/coming-soon"> <span>免费获取Kubernetes安全性、成本分配和规避、合规性和护栏。</span></a></p>
</blockquote>
<p data-type="unstyled" data-id="2eeefab4-af95-4ddb-a70b-b70a1a2ca5a0">无论您是使用开源解决方案还是与商业合作伙伴合作，为您的Kubernetes环境设置防护栏都将有助于您的开发人员快速、自信地发布产品。</p>
<p data-type="unstyled" data-id="2eeefab4-af95-4ddb-a70b-b70a1a2ca5a0"><span class="hs-cta-wrapper" id="hs-cta-wrapper-34aa4987-a1f9-438a-a145-d7d82d5c479a"><span class="hs-cta-node hs-cta-34aa4987-a1f9-438a-a145-d7d82d5c479a" id="hs-cta-34aa4987-a1f9-438a-a145-d7d82d5c479a"><a href="https://cta-redirect.hubspot.com/cta/redirect/2184645/34aa4987-a1f9-438a-a145-d7d82d5c479a"><img class="hs-cta-img" id="hs-cta-img-34aa4987-a1f9-438a-a145-d7d82d5c479a" src="../Images/7c86296320eb01b215d8e2755e9c5b9d.png" alt="Use Fairwinds Insights for Free Security, Cost and Developer Enablement In One" data-original-src="https://no-cache.hubspot.com/cta/default/2184645/34aa4987-a1f9-438a-a145-d7d82d5c479a.png"/></a></span>T6】</span></p></span></div>    
</body>
</html>