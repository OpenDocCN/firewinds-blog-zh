<html>
<head>
<title>Kubernetes Solved: Easily Find Deprecated API Versions with Pluto</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>Kubernetes已解决:使用Pluto很容易找到已弃用的API版本</h1>
<blockquote>原文：<a href="https://www.fairwinds.com/blog/kubernetes-easily-find-deprecated-api-versions-with-pluto#2023-01-20">https://www.fairwinds.com/blog/kubernetes-easily-find-deprecated-api-versions-with-pluto#2023-01-20</a></blockquote><div><span id="hs_cos_wrapper_post_body" class="hs_cos_wrapper hs_cos_wrapper_meta_field hs_cos_wrapper_type_rich_text" data-hs-cos-general-type="meta_field" data-hs-cos-type="rich_text"><h3>Pluto是一个开源工具，可以帮助用户在他们的基础设施即代码仓库和Helm版本中轻松找到不推荐的Kubernetes API版本。</h3>
<p>Kubernetes API版本化方案对开发人员来说非常好。它允许Kubernetes团队轻松地向alpha和beta API路径发布新特性，并在经过实战测试后将它们升级到稳定路径。当这种情况发生时，旧版本<a href="https://kubernetes.io/docs/reference/using-api/deprecation-policy/#deprecating-parts-of-the-api" rel="noopener" target="_blank">被弃用</a>，最终将被删除。这引发了许多围绕<a href="/blog/kubernetes-1.18.0-is-out-now-what" rel="noopener" target="_blank"> Kubernetes 1.16升级</a>的讨论，其中删除了多个不赞成使用的<code>Deployment</code>资源版本(除此之外，在这里阅读更多<a href="https://kubernetes.io/blog/2019/07/18/api-deprecations-in-1-16/" rel="noopener" target="_blank"/>)。找到被否决的版本是很痛苦的，你将被阻止升级到1.16，直到它们都被更新。我们决定编写一个开源实用程序，<a href="https://github.com/FairwindsOps/pluto" rel="noopener" target="_blank">冥王星</a>(以废弃的行星命名)，来解决这个问题。</p>

<h2><strong>背景</strong></h2>
<p>kube-apiserver非常灵活，不管请求中指定的API版本如何，它都会提供关于给定资源类型的相同信息。例如，在运行Kubernetes 1.15.X时，您可以运行以下命令来查看各种API版本的部署:</p>
<pre><code>$ kubectl get deployments.v1beta1.apps rbac-manager -o yaml
apiVersion: apps/v1beta1
kind: Deployment
metadata:
  name: rbac-manager
...

$ kubectl get deployments.v1beta2.apps rbac-manager -o yaml
apiVersion: apps/v1beta2
kind: Deployment
metadata:
  name: rbac-manager
...

$ kubectl get deployments.v1.apps rbac-manager -o yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: rbac-manager
...

$ kubectl get deployments.v1beta1.extensions rbac-manager-o yaml
apiVersion: extensions/v1beta1
kind: Deployment
metadata:
  name: rbac-manager
...
</code></pre>
<p>您会注意到，所有这些命令都返回相同的对象，但是将<code>apiVersion</code>设置为您在请求中请求的值。这使得无法判断实际部署到服务器上的是哪个版本，从而在升级时导致问题。当您有很多应用程序部署到您的Kubernetes集群时(就像我们的许多客户端一样)，集群升级到1.16版本可能会中断部署过程，可能会跨越数百个存储库。我们需要一种提前提供这些信息的方法，以便在升级发生之前解决部署过程。</p>
<h2><strong> Pluto识别弃用的Kubernetes文件</strong></h2>
<p>进入冥王星。您可以使用Pluto扫描各种来源的废弃API版本，包括平面清单文件、来自<code>helm template</code>命令的stdout，或者甚至直接与您的集群交互(如果您使用Helm进行部署的话)。例如，下面是使用Helm 3 (Pluto也支持Helm 2)部署应用程序的集群扫描:</p>
<pre><code>
$ pluto detect-helm --helm-version 3
KIND          VERSION        DEPRECATED   RESOURCE NAME
StatefulSet   apps/v1beta1   true         audit-dashboard-prod-rabbitmq-ha
Deployment    apps/v1        false        goldilocks-controller
Deployment    apps/v1        false        goldilocks-dashboard
</code></pre>
<p>Pluto告诉你你的<code>audit-dashboard-prod-rabbitmq-ha StatefulSet</code>是通过Helm用一个废弃的API部署的。现在，在1.16上部署之前，可以更容易地在图表存储库中定位和修复这个问题。</p>
<p>在升级到1.16之前，您可以使用Pluto验证在集群中运行的Helm图表、YAML清单和Helm部署，并更新任何不推荐使用的API。一旦冥王星通过，你就可以迁移到1.16版了。</p>
<p>Pluto现在是开源的，将被更新以包括Kubernetes的未来版本和对资源API的任何弃用。我们正在努力增加功能，所以请打开问题，加入我们的<a href="https://fairwindscommunity.slack.com/messages/pluto"> Slack频道</a>，并做出贡献！</p>
<p>寻找一个完整的Kubernetes治理平台？Fairwinds Insights是免费的。<a href="https://www.fairwinds.com/coming-soon"> <span>今天就开始。</span>T3】</a></p>
<h2>资源</h2>

<p><span class="hs-cta-wrapper" id="hs-cta-wrapper-df6709b9-c7f5-4c1a-8bf4-315f56b16325"><span class="hs-cta-node hs-cta-df6709b9-c7f5-4c1a-8bf4-315f56b16325" id="hs-cta-df6709b9-c7f5-4c1a-8bf4-315f56b16325"><a href="https://cta-redirect.hubspot.com/cta/redirect/2184645/df6709b9-c7f5-4c1a-8bf4-315f56b16325"><img class="hs-cta-img" id="hs-cta-img-df6709b9-c7f5-4c1a-8bf4-315f56b16325" src="../Images/ac3f87548e14243ac3414b06e023028d.png" alt="Just Posted: Kubernetes Benchmark Report 2023" data-original-src="https://no-cache.hubspot.com/cta/default/2184645/df6709b9-c7f5-4c1a-8bf4-315f56b16325.png"/></a></span>T6】</span></p></span></div>    
</body>
</html>