<html>
<head>
<title>What Is Goldilocks? (Or How to Set Your Kubernetes Resource Requests)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>什么是金发女孩？(或者如何设置您的Kubernetes资源请求)</h1>
<blockquote>原文：<a href="https://www.fairwinds.com/blog/goldilocks-kubernetes-resource-requests#2022-12-05">https://www.fairwinds.com/blog/goldilocks-kubernetes-resource-requests#2022-12-05</a></blockquote><div><span id="hs_cos_wrapper_post_body" class="hs_cos_wrapper hs_cos_wrapper_meta_field hs_cos_wrapper_type_rich_text" data-hs-cos-general-type="meta_field" data-hs-cos-type="rich_text"><p>当我们在2019年10月<a href="/blog/introducing-goldilocks-a-tool-for-recommending-resource-requests" rel="noopener" target="_blank">开源Goldilocks </a>时，我们的目标是提供一个仪表板实用程序，帮助您确定设置Kubernetes资源请求和限制的基线。我们<a href="/blog/new-in-goldilocks" rel="noopener" target="_blank">将继续完善Goldilocks </a>，因为让资源请求和限制恰到好处对大多数组织来说都是一个持续的挑战。</p>

<h2>为什么要设置资源配置？</h2>
<p>您可以在pod中的每个容器上设置两种类型的资源配置:请求和限制。资源请求定义了容器需要的最小资源。限制定义了容器可以使用的最大资源量。设置这些有助于防止您过度使用资源，同时也保护您的资源用于其他部署。请求会影响Kubernetes中pods的计划方式；调度程序读取pod中每个容器的请求，然后找到适合该pod的最佳节点。Kubernetes使用这些信息来优化您的资源利用。</p>
<h2>正确处理Kubernetes资源请求</h2>
<p>我们在推荐模式下使用Kubernetes <a href="https://github.com/kubernetes/autoscaler/tree/master/vertical-pod-autoscaler" rel="noopener nofollow" target="_blank">垂直窗格自动缩放器</a> (VPA)来查看我们每个应用程序上的资源请求建议。Goldilocks为名称空间中的每个部署创建一个VPA，然后向它们查询信息。虽然VPA可以设置资源请求，但Goldilocks中的仪表板可以方便地查看所有建议，并根据您对Kubernetes环境的了解做出决策。learnk8s.io上有一个关于在Kubernetes中设置正确的要求和限制的好帖子，有很多代码、细节和有趣的类比。</p>
<p>一旦您的VPA就绪，Goldilocks仪表盘中的建议如下所示:</p>
<p><img src="../Images/0db33908351c0a2fec9195999334976b.png" loading="lazy" data-original-src="https://lh3.googleusercontent.com/u2yVPgQNYDsZS2irWB-ZJwwopEi_JrXZhL1Yqu92wX9jREnDQqPg6Um64nPpXXExZZsFBSYIUTUmvvZzjuAcVbBd02R1gBCbKtimi4OlQr5CoUr1dsE0wwfms00klQ9peK9BbMCy"/></p>
<h2>金发女孩如何产生推荐？</h2>
<p>Goldilocks使用VPA中的<a href="https://github.com/kubernetes/autoscaler/blob/master/vertical-pod-autoscaler/pkg/recommender/README.md" rel="nofollow noopener" target="_blank">推荐器</a>进行推荐。根据<a href="https://github.com/kubernetes/autoscaler/blob/master/vertical-pod-autoscaler/pkg/recommender/README.md#implementation" rel="nofollow noopener" target="_blank"> VPA的文献</a>:</p>
<p>“启动二进制文件后，recommender会将运行pod的历史记录及其使用情况从Prometheus读入模型。然后，它循环运行，并在每一步执行以下操作:</p>
<ul>
<li>   <ul>
<li>使用资源的最新信息更新模型(使用基于观察的列表器)，</li>
<li>使用来自Metrics API的新使用示例更新模型，</li>
<li>为每个VPA计算新推荐，</li>
<li>将任何更改的建议放入VPA资源中。"</li>
</ul>
</li>
</ul>
<p>Goldilocks生成的建议基于pod在一段时间内的历史使用情况，因此您的决策不仅仅是基于一个时间点。</p>
<p>Goldilocks在仪表板中显示了两种类型的建议。这些建议基于Kubernetes <a href="https://kubernetes.io/docs/tasks/configure-pod-container/quality-service-pod/" rel="nofollow noopener" target="_blank">服务质量(QoS)等级</a>。QoS类别是Kubernetes的一个概念，它决定了pods被调度和驱逐的顺序，Kubernetes自己将QoS类别分配给pods。有三种类型的QoS类别:保证、突发和尽力而为。具有相同CPU和内存限制和请求的pod被放入有保证的QoS类别。CPU或内存请求低于其限制的pod被赋予突发QoS类别。BestEffort QoS类别适用于由没有任何请求或限制的容器组成的pod。(我们完全不建议这样做。)</p>
<p>使用Goldilocks，我们从历史数据中生成两种不同的QoS类别的建议:</p>
<ul>
<li>对于<strong>保证的</strong>，我们从建议中提取目标字段，并将其设置为该容器的请求和限制。这保证了容器请求的资源在被调度时可用，并且通常产生最稳定的Kubernetes集群。</li>
<li>对于<strong> Burstable </strong>，我们将请求设置为VPA对象的下限，将限制设置为上限。调度器使用请求将pod放在一个节点上，但是它允许pod在被终止或限制之前使用更多的资源，直到达到限制。这有助于处理峰值工作负载，但如果使用过多，会很快导致节点过度配置，使其不堪重负。</li>
</ul>
<h2>金发女孩有多准确？</h2>
<p>金凤花开源软件完全基于底层的VPA项目，特别是推荐者。根据我们的经验，Goldilocks是设置您的资源请求和限制的良好起点。但是每个环境都是不同的，Goldilocks不能代替针对您的特定用例调整您的应用程序。</p>
<h2>贡献给金发女孩</h2>
<p><a href="https://github.com/FairwindsOps/goldilocks" rel="noopener" target="_blank"> Goldilocks是开源的，可以在GitHub上获得</a>。我们继续进行大量的改进，提高其处理具有数百个名称空间和VPA对象的大型集群的能力。我们还改变了Goldilocks的部署方式，所以现在它包括了一个<a href="https://github.com/FairwindsOps/charts/tree/master/stable/vpa" rel="noopener" target="_blank"> VPA子图</a>，你可以用它来安装VPA控制器和它的资源。我们和<a href="https://github.com/hjkatz" rel="nofollow noopener" target="_blank">哈里森·卡茨</a>在SquareSpace做了很多改变，基于他和团队的宝贵反馈。我们希望不断改进我们的开源项目，并欢迎您的贡献！</p>
<p>Goldilocks也是我们的<a href="/insights" rel="noopener" target="_blank"> Fairwinds Insights平台</a>的一部分，该平台提供对您的Kubernetes集群的多集群可见性，因此您可以针对规模、可靠性、资源效率和安全性配置您的应用。</p>
<blockquote>
<p>您可以永远免费使用Fairwinds Insights。<a href="https://www.fairwinds.com/coming-soon"> <span>拿到这里</span> </a>。</p>
</blockquote>
<p><a href="/open-source-software-user-group" rel="noopener" target="_blank">加入我们的开源小组</a>——参加我们9月23日或12月14日的下一次聚会！</p>
<p><span class="hs-cta-wrapper" id="hs-cta-wrapper-b163554e-b5ef-4f40-a053-03afe6ecbee6"><span class="hs-cta-node hs-cta-b163554e-b5ef-4f40-a053-03afe6ecbee6" id="hs-cta-b163554e-b5ef-4f40-a053-03afe6ecbee6"><a href="https://cta-redirect.hubspot.com/cta/redirect/2184645/b163554e-b5ef-4f40-a053-03afe6ecbee6" target="_blank" rel="noopener"><img class="hs-cta-img" id="hs-cta-img-b163554e-b5ef-4f40-a053-03afe6ecbee6" src="../Images/8ab607311768483f3bb5136a75381d4b.png" alt="Join the Fairwinds Open Source User Group today" align="middle" data-original-src="https://no-cache.hubspot.com/cta/default/2184645/b163554e-b5ef-4f40-a053-03afe6ecbee6.png"/></a></span>T6】</span></p></span></div>    
</body>
</html>