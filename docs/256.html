<html>
<head>
<title>Introducing Astro: Manage Datadog Monitors in Kubernetes Deployments for Better Productivity and Cluster Performance</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>Astro简介:管理Kubernetes部署中的Datadog监视器，以提高工作效率和集群性能</h1>
<blockquote>原文：<a href="https://www.fairwinds.com/blog/introducing-astro-managing-monitors-in-a-dynamic-environment-0#2020-06-09">https://www.fairwinds.com/blog/introducing-astro-managing-monitors-in-a-dynamic-environment-0#2020-06-09</a></blockquote><div><span id="hs_cos_wrapper_post_body" class="hs_cos_wrapper hs_cos_wrapper_meta_field hs_cos_wrapper_type_rich_text" data-hs-cos-general-type="meta_field" data-hs-cos-type="rich_text"><div>
<h3><span class=" author-d-1gg9uz65z1iz85zgdz68zmqkz84zo2qovvz89zqz84zz74zz81zt3z65zyz75zz70zqxuz73z08p7wz90zz90ziz85zz68zz76zz74zfz73zz89z"><span class=" author-d-1gg9uz65z1iz85zgdz68zmqkz84zo2qovvz89zqz84zz74zz81zt3z65zyz75zz70zqxuz73z08p7wz90zz90ziz85zz68zz76zz74zfz73zz89z"/>T3】</span></h3>
<h3>“Astro利用新的Kubernetes-native模式，帮助工程师以声明方式管理Datadog监视器，以适应这些环境的短暂性。我们很高兴能与Fairwinds合作，并支持他们努力使这一工具惠及整个社区。”</h3>
<h3>—迈克尔·格斯滕哈伯，Datadog产品管理总监</h3>
<p><span><img src="../Images/61487c422b56a780a9187ca52f87ecf9.png" alt="Artboard 2" srcset="https://www.fairwinds.com/hs-fs/hubfs/Artboard%202.png?width=30&amp;name=Artboard%202.png 30w, https://www.fairwinds.com/hs-fs/hubfs/Artboard%202.png?width=60&amp;name=Artboard%202.png 60w, https://www.fairwinds.com/hs-fs/hubfs/Artboard%202.png?width=90&amp;name=Artboard%202.png 90w, https://www.fairwinds.com/hs-fs/hubfs/Artboard%202.png?width=120&amp;name=Artboard%202.png 120w, https://www.fairwinds.com/hs-fs/hubfs/Artboard%202.png?width=150&amp;name=Artboard%202.png 150w, https://www.fairwinds.com/hs-fs/hubfs/Artboard%202.png?width=180&amp;name=Artboard%202.png 180w" sizes="(max-width: 60px) 100vw, 60px" data-original-src="https://www.fairwinds.com/hs-fs/hubfs/Artboard%202.png?width=60&amp;name=Artboard%202.png"/>T2】</span></p>
<p><span class=" author-d-1gg9uz65z1iz85zgdz68zmqkz84zo2qovvz89zqz84zz74zz81zt3z65zyz75zz70zqxuz73z08p7wz90zz90ziz85zz68zz76zz74zfz73zz89z">在Kubernetes环境中，我们看到的挑战之一是反映集群和工作负载状态的准确监控管理。监控往往是事后才想到的:</span> <span class=" author-d-1gg9uz65z1iz85zgdz68zmqkz84zo2qovwiz71z7z72z8u1z80zyz65zh8z71z88ez75zz75zz75zz66zhz75z2c23nz90zz67zz80z"> a </span> <span class=" author-d-1gg9uz65z1iz85zgdz68zmqkz84zo2qovvz89zqz84zz74zz81zt3z65zyz75zz70zqxuz73z08p7wz90zz90ziz85zz68zz76zz74zfz73zz89z"> s工作负载变化</span> <span class=" author-d-1gg9uz65z1iz85zgdz68zmqkz84zo2qovwiz71z7z72z8u1z80zyz65zh8z71z88ez75zz75zz75zz66zhz75z2c23nz90zz67zz80z">，</span> <span class=" author-d-1gg9uz65z1iz85zgdz68zmqkz84zo2qovvz89zqz84zz74zz81zt3z65zyz75zz70zqxuz73z08p7wz90zz90ziz85zz68zz76zz74zfz73zz89z">很少进行监控更新。现有的工具依赖于手工配置监控状态</span> <span class=" author-d-1gg9uz65z1iz85zgdz68zmqkz84zo2qovwiz71z7z72z8u1z80zyz65zh8z71z88ez75zz75zz75zz66zhz75z2c23nz90zz67zz80z">、</span> <span class=" author-d-1gg9uz65z1iz85zgdz68zmqkz84zo2qovvz89zqz84zz74zz81zt3z65zyz75zz70zqxuz73z08p7wz90zz90ziz85zz68zz76zz74zfz73zz89z">，这给SRE团队带来了很大的麻烦。它还增加了可用性和性能风险，因为监视器可能不存在或不够准确，无法触发KPI</span><span class=" author-d-1gg9uz65z1iz85zgdz68zmqkz84zo2qovvz89zqz84zz74zz81zt3z65zyz75zz70zqxuz73z08p7wz90zz90ziz85zz68zz76zz74zfz73zz89z h-lparen">(关键</span> <span class=" author-d-1gg9uz65z1iz85zgdz68zmqkz84zo2qovvz89zqz84zz74zz81zt3z65zyz75zz70zqxuz73z08p7wz90zz90ziz85zz68zz76zz74zfz73zz89z">性能指标)的变化。</span> <span class="thread-890165687925037267144064 author-d-1gg9uz65z1iz85zgdz68zmqkz84zo2qovvz89zqz84zz74zz81zt3z65zyz75zz70zqxuz73z08p7wz90zz90ziz85zz68zz76zz74zfz73zz89z">由于未检测到的</span> <span class="thread-890165687925037267144064 author-d-1gg9uz65z1iz85zgdz68zmqkz84zo2qoxw4z74zjbnz65zz65z6ldz89zt9z82zz71z4odfz70zz80zz67zquz85zps5z87zz67z">问题</span> <span class="thread-890165687925037267144064 author-d-1gg9uz65z1iz85zgdz68zmqkz84zo2qovvz89zqz84zz74zz81zt3z65zyz75zz70zqxuz73z08p7wz90zz90ziz85zz68zz76zz74zfz73zz89z">和/或</span> <span class="thread-890165687925037267144064 author-d-1gg9uz65z1iz85zgdz68zmqkz84zo2qovvz89zqz84zz74zz81zt3z65zyz75zz70zqxuz73z08p7wz90zz90ziz85zz68zz76zz74zfz73zz89z">不正确的</span> <span class="thread-890165687925037267144064 author-d-1gg9uz65z1iz85zgdz68zmqkz84zo2qoxw4z74zjbnz65zz65z6ldz89zt9z82zz71z4odfz70zz80zz67zquz85zps5z87zz67z">监视器设置</span> <span class="thread-890165687925037267144064 author-d-1gg9uz65z1iz85zgdz68zmqkz84zo2qovvz89zqz84zz74zz81zt3z65zyz75zz70zqxuz73z08p7wz90zz90ziz85zz68zz76zz74zfz73zz89z">导致的传呼机噪音，这可能导致SLA违约。</span></p>
</div>

<p> </p>
<div><span class=" author-d-1gg9uz65z1iz85zgdz68zmqkz84zo2qovvz89zqz84zz74zz81zt3z65zyz75zz70zqxuz73z08p7wz90zz90ziz85zz68zz76zz74zfz73zz89z">To tackle this problem, Fairwinds </span><span class=" author-d-1gg9uz65z1iz85zgdz68zmqkz84zo2qovwiz71z7z72z8u1z80zyz65zh8z71z88ez75zz75zz75zz66zhz75z2c23nz90zz67zz80z">has</span><span class=" author-d-1gg9uz65z1iz85zgdz68zmqkz84zo2qovvz89zqz84zz74zz81zt3z65zyz75zz70zqxuz73z08p7wz90zz90ziz85zz68zz76zz74zfz73zz89z"> introduce</span><span class=" author-d-1gg9uz65z1iz85zgdz68zmqkz84zo2qovwiz71z7z72z8u1z80zyz65zh8z71z88ez75zz75zz75zz66zhz75z2c23nz90zz67zz80z">d</span><span class=" author-d-1gg9uz65z1iz85zgdz68zmqkz84zo2qovvz89zqz84zz74zz81zt3z65zyz75zz70zqxuz73z08p7wz90zz90ziz85zz68zz76zz74zfz73zz89z"> a new </span><span class=" author-d-1gg9uz65z1iz85zgdz68zmqkz84zo2qovwiz71z7z72z8u1z80zyz65zh8z71z88ez75zz75zz75zz66zhz75z2c23nz90zz67zz80z">open source software project </span><span class=" author-d-1gg9uz65z1iz85zgdz68zmqkz84zo2qovvz89zqz84zz74zz81zt3z65zyz75zz70zqxuz73z08p7wz90zz90ziz85zz68zz76zz74zfz73zz89z">called Astro. Astro is a Kubernetes operator that watches objects in your cluster for defined patterns and manages Datadog monitors based on this state.</span>
<h4>Astro提供了三个关键元素来大大简化Datadog监视器管理:</h4>
<ul>
<li><h4><strong>Datadog监视器的自动化生命周期管理:</strong>给定配置参数，实用程序将自动管理Kubernetes集群中所有相关对象的已定义监视器。随着对象的变化，监视器会更新以反映该状态，从而消除了手动配置的需要。</h4></li>
<li><h4> <strong>逻辑绑定对象之间的关联:</strong> Astro能够管理给定名称空间内所有对象的监视器。这确保了显示器配置之间的更大一致性。</h4></li>
<li><h4> <strong>将Kubernetes对象中的值模板化到受管监视器中:</strong>受管Kubernetes对象中的任何数据都可以插入到受管监视器中。这将生成更多信息性和情境化的警报，从而更容易对问题进行分类。</h4></li>
</ul>

</div>
<div><span class=" author-d-1gg9uz65z1iz85zgdz68zmqkz84zo2qovvz89zqz84zz74zz81zt3z65zyz75zz70zqxuz73z08p7wz90zz90ziz85zz68zz76zz74zfz73zz89z"><span class="hs-cta-wrapper" id="hs-cta-wrapper-ae582ca9-6cdc-4ca6-b29c-bac1250db55a"><span class="hs-cta-node hs-cta-ae582ca9-6cdc-4ca6-b29c-bac1250db55a" id="hs-cta-ae582ca9-6cdc-4ca6-b29c-bac1250db55a"><a href="https://cta-redirect.hubspot.com/cta/redirect/2184645/ae582ca9-6cdc-4ca6-b29c-bac1250db55a" target="_blank" rel="noopener"><img class="hs-cta-img" id="hs-cta-img-ae582ca9-6cdc-4ca6-b29c-bac1250db55a" src="../Images/73fb89b760e7e4f19527ea76256ae988.png" alt="Try Astro Today" align="middle" data-original-src="https://no-cache.hubspot.com/cta/default/2184645/ae582ca9-6cdc-4ca6-b29c-bac1250db55a.png"/></a></span></span></span></div>
<h2><strong> <span class=" author-d-1gg9uz65z1iz85zgdz68zmqkz84zo2qovvz89zqz84zz74zz81zt3z65zyz75zz70zqxuz73z08p7wz90zz90ziz85zz68zz76zz74zfz73zz89z">入门</span>T3】</strong></h2>
<p>您可以通过两个简单的步骤在集群中运行Astro:配置您想要的监视器，并部署helm chart。</p>
<p><span class=" author-d-1gg9uz65z1iz85zgdz68zmqkz84zo2qovvz89zqz84zz74zz81zt3z65zyz75zz70zqxuz73z08p7wz90zz90ziz85zz68zz76zz74zfz73zz89z"> </span></p>
<p><span class=" author-d-1gg9uz65z1iz85zgdz68zmqkz84zo2qovvz89zqz84zz74zz81zt3z65zyz75zz70zqxuz73z08p7wz90zz90ziz85zz68zz76zz74zfz73zz89z">监视器通过一个或多个yaml配置文件进行配置。</span> <span class=" author-d-1gg9uz65z1iz85zgdz68zmqkz84zo2qovvz89zqz84zz74zz81zt3z65zyz75zz70zqxuz73z08p7wz90zz90ziz85zz68zz76zz74zfz73zz89z">这些文件可以是本地文件路径或通过URL远程访问。</span> <span class=" author-d-1gg9uz65z1iz85zgdz68zmqkz84zo2qovvz89zqz84zz74zz81zt3z65zyz75zz70zqxuz73z08p7wz90zz90ziz85zz68zz76zz74zfz73zz89z">这些配置文件会定期重新加载，因此您所做的任何更改最终都会传播到您的显示器上。下面是一个配置示例:</span></p>

<br/>
<div><span class="thread-158430625488538944002928 author-d-1gg9uz65z1iz85zgdz68zmqkz84zo2qovvz89zqz84zz74zz81zt3z65zyz75zz70zqxuz73z08p7wz90zz90ziz85zz68zz76zz74zfz73zz89z">In this example, a monitor would be created for any Kubernetes deployments that have the annotations listed in </span><span class="inline-code thread-158430625488538944002928 author-d-1gg9uz65z1iz85zgdz68zmqkz84zo2qovvz89zqz84zz74zz81zt3z65zyz75zz70zqxuz73z08p7wz90zz90ziz85zz68zz76zz74zfz73zz89z"><span>match_annotations</span></span> <span class="thread-158430625488538944002928 author-d-1gg9uz65z1iz85zgdz68zmqkz84zo2qovvz89zqz84zz74zz81zt3z65zyz75zz70zqxuz73z08p7wz90zz90ziz85zz68zz76zz74zfz73zz89z h-lparen">(in</span><span class="thread-158430625488538944002928 author-d-1gg9uz65z1iz85zgdz68zmqkz84zo2qovvz89zqz84zz74zz81zt3z65zyz75zz70zqxuz73z08p7wz90zz90ziz85zz68zz76zz74zfz73zz89z"> this case, </span><span class="inline-code thread-158430625488538944002928 author-d-1gg9uz65z1iz85zgdz68zmqkz84zo2qovvz89zqz84zz74zz81zt3z65zyz75zz70zqxuz73z08p7wz90zz90ziz85zz68zz76zz74zfz73zz89z"><span>astro/owner: </span></span><span class="inline-code author-d-1gg9uz65z1iz85zgdz68zmqkz84zo2qovvz89zqz84zz74zz81zt3z65zyz75zz70zqxuz73z08p7wz90zz90ziz85zz68zz76zz74zfz73zz89z"><span>as</span></span><span class="inline-code thread-158430625488538944002928 author-d-1gg9uz65z1iz85zgdz68zmqkz84zo2qovvz89zqz84zz74zz81zt3z65zyz75zz70zqxuz73z08p7wz90zz90ziz85zz68zz76zz74zfz73zz89z"><span>tro</span></span><span class="thread-158430625488538944002928 author-d-1gg9uz65z1iz85zgdz68zmqkz84zo2qovvz89zqz84zz74zz81zt3z65zyz75zz70zqxuz73z08p7wz90zz90ziz85zz68zz76zz74zfz73zz89z">).  </span><span class="thread-121745230223641569002248 author-d-1gg9uz65z1iz85zgdz68zmqkz84zo2qovvz89zqz84zz74zz81zt3z65zyz75zz70zqxuz73z08p7wz90zz90ziz85zz68zz76zz74zfz73zz89z">This particular monitor will alert you when a deployment has no pods available.</span> <span class="thread-121745230223641569002248 author-d-1gg9uz65z1iz85zgdz68zmqkz84zo2qovvz89zqz84zz74zz81zt3z65zyz75zz70zqxuz73z08p7wz90zz90ziz85zz68zz76zz74zfz73zz89z">Astro uses go templating</span><span class=" author-d-1gg9uz65z1iz85zgdz68zmqkz84zo2qovvz89zqz84zz74zz81zt3z65zyz75zz70zqxuz73z08p7wz90zz90ziz85zz68zz76zz74zfz73zz89z"> and you can insert any variables from the Kubernetes object </span><span class=" author-d-1gg9uz65z1iz85zgdz68zmqkz84zo2qovvz89zqz84zz74zz81zt3z65zyz75zz70zqxuz73z08p7wz90zz90ziz85zz68zz76zz74zfz73zz89z"><i>or </i></span><span class=" author-d-1gg9uz65z1iz85zgdz68zmqkz84zo2qovvz89zqz84zz74zz81zt3z65zyz75zz70zqxuz73z08p7wz90zz90ziz85zz68zz76zz74zfz73zz89z">from the </span><span class="inline-code author-d-1gg9uz65z1iz85zgdz68zmqkz84zo2qovvz89zqz84zz74zz81zt3z65zyz75zz70zqxuz73z08p7wz90zz90ziz85zz68zz76zz74zfz73zz89z"><span>cluster_variables</span></span><span class=" author-d-1gg9uz65z1iz85zgdz68zmqkz84zo2qovvz89zqz84zz74zz81zt3z65zyz75zz70zqxuz73z08p7wz90zz90ziz85zz68zz76zz74zfz73zz89z"> section of your config file into monitors. Specific details about the config file syntax is available in </span><span class="thread-942913340749890681183211 author-d-1gg9uz65z1iz85zgdz68zmqkz84zo2qovvz89zqz84zz74zz81zt3z65zyz75zz70zqxuz73z08p7wz90zz90ziz85zz68zz76zz74zfz73zz89z">Astro’s</span> <span class="attrlink url thread-942913340749890681183211 author-d-1gg9uz65z1iz85zgdz68zmqkz84zo2qovvz89zqz84zz74zz81zt3z65zyz75zz70zqxuz73z08p7wz90zz90ziz85zz68zz76zz74zfz73zz89z"><a target="_blank" class="attrlink" data-target-href="https://github.com/FairwindsOps/astro/blob/master/README.md" href="https://github.com/FairwindsOps/astro/blob/master/README.md" rel="noreferrer nofollow noopener">readme</a></span><span class=" author-d-1gg9uz65z1iz85zgdz68zmqkz84zo2qoxw4z74zjbnz71zz87zz88zyj0flp65idsz83zz82zz87zz87zuz72zz86zz90ztgz81z">.</span></div>
<p> </p>
<div><span class=" author-d-1gg9uz65z1iz85zgdz68zmqkz84zo2qovvz89zqz84zz74zz81zt3z65zyz75zz70zqxuz73z08p7wz90zz90ziz85zz68zz76zz74zfz73zz89z">Once your config file is in place, you’re ready to deploy with helm! The helm chart is available </span><span class="attrlink url author-d-1gg9uz65z1iz85zgdz68zmqkz84zo2qoxw4z74zjbnz71zz87zz88zyj0flp65idsz83zz82zz87zz87zuz72zz86zz90ztgz81z"><a target="_blank" class="attrlink" data-target-href="https://github.com/FairwindsOps/charts/tree/master/incubator/astro" href="https://github.com/FairwindsOps/charts/tree/master/incubator/astro" rel="noreferrer nofollow noopener">on GitHub</a></span><span class=" author-d-1gg9uz65z1iz85zgdz68zmqkz84zo2qovvz89zqz84zz74zz81zt3z65zyz75zz70zqxuz73z08p7wz90zz90ziz85zz68zz76zz74zfz73zz89z">. If you’re installing with </span><span class="thread-195795693686403693573396 author-d-1gg9uz65z1iz85zgdz68zmqkz84zo2qovvz89zqz84zz74zz81zt3z65zyz75zz70zqxuz73z08p7wz90zz90ziz85zz68zz76zz74zfz73zz89z">Reckoner</span><span class=" author-d-1gg9uz65z1iz85zgdz68zmqkz84zo2qovvz89zqz84zz74zz81zt3z65zyz75zz70zqxuz73z08p7wz90zz90ziz85zz68zz76zz74zfz73zz89z">, a tool to declaratively install and manage multiple Helm chart releases, here’s a snippet to install </span><span class="thread-387106074658092325440889 author-d-1gg9uz65z1iz85zgdz68zmqkz84zo2qovvz89zqz84zz74zz81zt3z65zyz75zz70zqxuz73z08p7wz90zz90ziz85zz68zz76zz74zfz73zz89z">Astro:</span></div>
<br/>
<div><span class="thread-560198451958618364344415 author-d-1gg9uz65z1iz85zgdz68zmqkz84zo2qovvz89zqz84zz74zz81zt3z65zyz75zz70zqxuz73z08p7wz90zz90ziz85zz68zz76zz74zfz73zz89z">In case you haven’t tried Reckoner, it’s available </span><span class="attrlink url thread-560198451958618364344415 author-d-1gg9uz65z1iz85zgdz68zmqkz84zo2qoxw4z74zjbnz71zz87zz88zyj0flp65idsz83zz82zz87zz87zuz72zz86zz90ztgz81z"><a target="_blank" class="attrlink" data-target-href="https://github.com/fairwindsops/reckoner" href="https://github.com/fairwindsops/reckoner" rel="noreferrer nofollow noopener">on GitHub</a></span><span class="thread-560198451958618364344415 author-d-1gg9uz65z1iz85zgdz68zmqkz84zo2qovvz89zqz84zz74zz81zt3z65zyz75zz70zqxuz73z08p7wz90zz90ziz85zz68zz76zz74zfz73zz89z">.</span></div>
<p> </p><h2 data-usually-unique-id="214802774048929146455516"><span class=" author-d-1gg9uz65z1iz85zgdz68zmqkz84zo2qovvz89zqz84zz74zz81zt3z65zyz75zz70zqxuz73z08p7wz90zz90ziz85zz68zz76zz74zfz73zz89z"> <br/> <strong>欣赏天文</strong> </span></h2>

<p>现在，每次使用astro/owner注释创建部署时，astro都会自动为它创建一个Datadog监视器，如果它关闭了，我们会收到一个警报。如果没有Astro，我们将不得不依靠工程团队手动创建这些监视器，这既耗时又容易出错。</p>
<p> </p>
<p><span class="thread-963053160120114220237019 author-d-1gg9uz65z1iz85zgdz68zmqkz84zo2qovvz89zqz84zz74zz81zt3z65zyz75zz70zqxuz73z08p7wz90zz90ziz85zz68zz76zz74zfz73zz89z"> Astro是一个伟大的</span> <span class="thread-963053160120114220237019 author-d-1gg9uz65z1iz85zgdz68zmqkz84zo2qovwiz71z7z72z8u1z80zyz65zh8z71z88ez75zz75zz75zz66zhz75z2c23nz90zz67zz80z">开源项目</span> <span class="thread-963053160120114220237019 author-d-1gg9uz65z1iz85zgdz68zmqkz84zo2qovvz89zqz84zz74zz81zt3z65zyz75zz70zqxuz73z08p7wz90zz90ziz85zz68zz76zz74zfz73zz89z">，它可以用来保持您的显示器同步，防止因显示器配置错误而中断，并对抗寻呼机疲劳。我们希望您喜欢自动化管理您的Datadog监视器！<br/><br/><br/>T8】</span></p>
</span></div>    
</body>
</html>