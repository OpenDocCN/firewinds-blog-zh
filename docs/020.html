<html>
<head>
<title>Kubernetes DevOps Tip #5: Why Setting imagePullPolicy to Always is More Necessary Than You Think</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>Kubernetes DevOps提示5:为什么将imagePullPolicy设置为Always比您想象的更有必要</h1>
<blockquote>原文：<a href="https://www.fairwinds.com/blog/kubernetes-devops-tip-5-why-setting-imagepullpolicy-to-always-is-more-necessary-than-you-think#2023-01-10">https://www.fairwinds.com/blog/kubernetes-devops-tip-5-why-setting-imagepullpolicy-to-always-is-more-necessary-than-you-think#2023-01-10</a></blockquote><div><span id="hs_cos_wrapper_post_body" class="hs_cos_wrapper hs_cos_wrapper_meta_field hs_cos_wrapper_type_rich_text" data-hs-cos-general-type="meta_field" data-hs-cos-type="rich_text"><p>这篇博客将讨论围绕Kubernetes容器的Pull策略的更好实践的需求，该策略是使用pod规范中的<span> imagePullPolicy </span>字段设置的。当<span>imagepulpolicy</span>设置为<span> Always </span>时，用户可以确保每次启动Kubernetes pod时都部署最新版本的映像。</p>

<h2>依靠缓存版本</h2>
<p>依赖缓存版本的Docker图像会引入安全漏洞，因为Kubernetes会试图使用缓存版本的图像，而不验证它来自哪里。如果攻击者能够替换缓存的图像，并且<span> imagePullPolicy </span>被设置为<span> IfNotPresent </span>，那么Kubernetes将很乐意运行您放在节点上的任何图像。此外，不使用<span> Always </span> pull策略会导致每个节点上运行的映像发生变化。</p>
<p>例如，许多项目会发布带有图像标签<span> 1 </span>、<span> 1.2 </span>和<span> 1.2.3 </span>的版本<span> 1.2.3 </span>。关于Kubernetes配置，可以指定标签<span> 1.2 </span>，因此当<span> 1.2.4 </span>发布安全补丁时，它会在下次重新安排或重启pod时自动流入。但是，如果用户没有指定<span>imagepulpolicy:Always</span>，那么Kubernetes集群将继续使用缓存的<span> 1.2 </span>标签，该标签仍然指向<span> 1.2.3 </span>。</p>
<p>为了解决这个问题，Kubernetes使用了<span> imagePullPolicy </span>。根据<a href="https://kubernetes.io/docs/concepts/configuration/overview/#container-images" rel="noopener" target="_blank"> <span> Kubernetes文档</span> </a>和配置最佳实践，当<span> imagePullPolicy </span>设置为<span> Always </span>时，kubelet(也称为主“节点代理”)将查询容器映像注册表，以便在每次启动容器时将名称解析为映像摘要。</p>
<p>如果kubelet有一个包含本地缓存的精确摘要的容器图像，它就使用它的缓存图像。否则，kubelet下载(或提取)带有解析摘要的图像，使用该图像启动容器。这里需要注意的是，将<span> imagePullPolicy </span>设置为<span> Always </span>不会绕过本地容器缓存机制，它只是验证缓存是否与上游源匹配。这意味着这种配置几乎没有缺点。</p>
<h2>通过洞察力获得正确的设置</h2>
<p>您可以通过确保将<span>imagepulpolicy</span>设置为<span> Always </span>来避免图像问题。当然，您的团队可以手动检查这个策略，但是这项工作会占用应用程序开发的时间、精力和资源。相反，您可以使用配置验证软件，如<a href="https://www.fairwinds.com/?utm_source=adwords&amp;utm_medium=ppc&amp;utm_term=fairwinds%20insights&amp;utm_campaign=Branded&amp;hsa_cam=9424392662&amp;hsa_mt=b&amp;hsa_ver=3&amp;hsa_src=g&amp;hsa_ad=524170558549&amp;hsa_net=adwords&amp;hsa_tgt=kwd-1494176964684&amp;hsa_acc=8748715703&amp;hsa_grp=95380032853&amp;hsa_kw=fairwinds%20insights&amp;gclid=Cj0KCQjwl7qSBhD-ARIsACvV1X1g_8YMyD-_sAolWXtzaxdIFne7GApsVaI8szm73UGjQTqQrA4HS_UaApEMEALw_wcB"><span>fair winds Insights</span></a>，来自动检查您的<span> imagePullPolicy </span>。</p>
<p>为了解决这个问题，Insights会在未指定标签时触发警告，或者如果<span>imagepulpolicy</span>未正确设置为<span> Always </span>。然后，您的团队可以修复清单，避免应用程序停机、错误等问题。</p>
<p>Fairwinds Insights还可以贯穿您的整个部署流程，这意味着从CI/CD到生产，始终会验证<span> imagePullPolicy </span>。</p>
<p>Fairwinds Insights将通过扫描CI中的基础架构代码，并在Kubernetes API前作为准入控制器运行，从一开始就阻止这些工作负载进入您的Kubernetes集群。</p>
<p>有兴趣尝试见解吗？它可以免费使用。你可以在这里报名。安装Fairwinds Insights代理后，您将在5-10分钟内找到结果。您可以轻松地检查是否有<a href="https://www.fairwinds.com/blog/how-to-identify-over-permissioned-containers"> <span>超过许可的容器</span> </a>，以及其他可靠性问题，如缺少<a href="https://www.fairwinds.com/blog/how-to-identify-missing-readiness-probes-in-kubernetes"> <span>准备就绪或活性探测器</span> </a>。</p>
<p><br/> <span class="hs-cta-wrapper" id="hs-cta-wrapper-34aa4987-a1f9-438a-a145-d7d82d5c479a"> <span class="hs-cta-node hs-cta-34aa4987-a1f9-438a-a145-d7d82d5c479a" id="hs-cta-34aa4987-a1f9-438a-a145-d7d82d5c479a"> <a href="https://cta-redirect.hubspot.com/cta/redirect/2184645/34aa4987-a1f9-438a-a145-d7d82d5c479a"> <img class="hs-cta-img" id="hs-cta-img-34aa4987-a1f9-438a-a145-d7d82d5c479a" src="../Images/7c86296320eb01b215d8e2755e9c5b9d.png" alt="Use Fairwinds Insights for Free Security, Cost and Developer Enablement In One" data-original-src="https://no-cache.hubspot.com/cta/default/2184645/34aa4987-a1f9-438a-a145-d7d82d5c479a.png"/> </a> </span> </span></p></span></div>    
</body>
</html>