<html>
<head>
<title>Making Sense of Kubernetes with Fairwinds Insights</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>利用Fairwinds Insights了解Kubernetes</h1>
<blockquote>原文：<a href="https://www.fairwinds.com/blog/making-sense-of-kubernetes-with-fairwinds-insights#2022-12-12">https://www.fairwinds.com/blog/making-sense-of-kubernetes-with-fairwinds-insights#2022-12-12</a></blockquote><div><span id="hs_cos_wrapper_post_body" class="hs_cos_wrapper hs_cos_wrapper_meta_field hs_cos_wrapper_type_rich_text" data-hs-cos-general-type="meta_field" data-hs-cos-type="rich_text"><p>当我开始与Kubernetes合作时，我认为这是一个相当简单的转变。我在AWS工作了很多年，在那之前我也在Linux上工作了很多年。我知道如何构建容器、配置虚拟机、联网、管理内存和CPU，以及在云中运行工作负载所需的一切。在谷歌，我甚至与Kubernetes的前任博格共事过。学习另一个计算框架有多难？</p>

<p>事实证明，非常困难。尽管我已经在一家专门从事Kubernetes支持的公司工作了一年多，但我仍然每天都在学习。Kubernetes不仅仅是一种新的语法——它是一种全新的思考分布式计算的方式。</p>
<p>到目前为止，最困难的是生态系统的深度。核心项目有超过200万行代码，并附带了<a href="https://kubernetes.io/docs/home/" rel="noopener" target="_blank">大量文档</a>。再加上几十个SIG和数百个第三方插件，既有开源的也有专有的，很容易让人不知所措。</p>
<p>这种复杂性使得Kubernetes成为一个非常强大和灵活的计算管理平台，这也是为什么超过一半的财富500强企业采用了它。但是随着建立一个集群的方法的爆炸式增长，错误几乎是不可避免的。保持Kubernetes集群的安全性、高效性和可靠性需要大量的知识和经验。</p>
<p>社区已经建立了一些令人惊讶的开源工具来审计Kubernetes基础设施，这有可能极大地缓解这些问题。但是审计生态系统是复杂的、支离破碎的，并且是不断变化的。因此，我们在一套开源审计工具的基础上构建了一个抽象层,<a href="/insights" rel=" noopener"> Fairwinds Insights </a>。Fairwinds Insights帮助组织轻松了解他们做得对的地方，以及他们需要关注的地方。</p>
<h2><strong>一个庞大的开源生态系统</strong></h2>
<p>我很幸运能在老兵面前了解到Kubernetes。我们有一个出色的sre团队，他们已经为几十个组织管理了数百个集群。他们已经看到Kubernetes在各种可能的情况下出错，我非常幸运能够从他们的经验中学习，而不是从我自己的错误中学习(尽管也有很多这样的错误！)</p>
<p>甚至在我到达之前，他们已经开始组装一个名为Polaris的开源仪表板，用来扫描Kubernetes的工作负载，查找常见的配置错误。它检查从安全性(比如以root用户身份运行容器)、效率(比如不请求特定数量的内存/CPU)到可靠性(比如无法设置活性和就绪性探测)的各种问题。如果没有像Polaris这样的项目来告诉我我错过了什么，我在将工作负载部署到Kubernetes时可能需要更多的指导。</p>
<p>该团队还指出，开源社区已经建立了几十个类似的工具。集装箱扫描有<a href="https://github.com/aquasecurity/trivy" rel="noopener" target="_blank">繁琐</a>；<a href="https://github.com/aquasecurity/kube-bench/" rel="noopener" target="_blank"> kube-bench </a>用于测试您与<a href="https://www.cisecurity.org/cis-benchmarks/" rel="noopener" target="_blank"> CIS基准</a>的对准情况；或者我们自己的<a href="https://github.com/FairwindsOps/goldilocks/" rel="noopener" target="_blank"> Goldilocks </a>来调整CPU和内存设置。我们最终仅编目了30多种开源安全工具！</p>
<p>外界审计工具的数量和种类之多很快就让人应接不暇。这些工具有些运行在集群中，有些运行在本地机器上。其中一些查看正在运行的工作负载，另一些查看上游的YAML文件。它们都不能跨多个集群核对数据，随着时间的推移跟踪结果，或者在新问题出现时发出警报。它们都有不同的输出格式，用不同的方式表示严重性和工作负载身份。</p>
<p>我们无法继续手动运行所有这些审核，从这些审核中寻找新的发现，并手动创建票证。我们需要一种方法来操作所有这些数据。</p>
<h2>构建解决方案</h2>
<p>为了让我们的生活——以及我们的客户的生活——更轻松，我们创建了一个基于插件的系统来整理和跟踪审计数据。这包括四个主要部分:</p>
<ul>
<li>后端存储</li>
<li>翻译层</li>
<li>集群内代理</li>
<li>图形用户界面仪表板</li>
</ul>
<h3>后端</h3>
<p>首先，我们构建了一些公共基础设施——即JSON存储和PostgreSQL数据库——任何报告工具都可以链接到其中。每个单独报告的输出在S3保存为JSON，更多的结构化数据被提取并存储在数据库中。</p>
<p>我们数据库模式的核心是一个被称为<a href="https://insights.docs.fairwinds.com/features/action-items" rel="noopener" target="_blank">行动项目</a>的概念——由任何审计生成的发现——它捕获安全性、效率或可靠性的潜在问题。</p>
<h3>翻译层</h3>
<p>在此基础上，我们构建了一个瘦翻译层:基本上，一些Go代码将每个报告的独特输出转换成行动项目。在这里，我们提取资源名称、严重性级别、人类可读的描述和补救建议。其中一些包含在基础报告中，而一些我们需要用自己的知识和研究来补充。</p>
<p>翻译层是代码库中最难维护的部分，因为每当报告添加新功能或更改其输出结构时，都需要对其进行更新。但是它非常有价值。他们可以利用洞察力以一种格式自动查看所有审计数据，而不是每个组织都试图在许多不同的审计工具上构建自己的抽象。</p>
<h3><strong>代理人</strong></h3>
<p>接下来，我们构建了一个代理来运行每一个开源审计——目前总共有9个——并将结果发送回我们的服务器，在那里它们被转换成操作项。这些报告都按照可配置的时间表运行，通常每小时一次，因此我们始终可以了解集群内部的最新情况。当某个问题得到解决时，我们也会选择它，并且可以自动关闭相应的行动项。</p>
<p>这比典型的方法要简单和健壮得多，典型的方法是在特定的基础上手动运行每个工具，而不参考以前的运行。</p>
<h3>仪表板</h3>
<p>最后，我们在<a href="https://insights.fairwinds.com/auth/login" rel="noopener" target="_blank">insights.fairwinds.com</a>建立了一个用户界面，用户可以登录并查看他们的结果。我们有一个用于查看所有行动项目的单一表格，以及一些用于深入研究单个报告的定制界面。这使得我们的用户可以享受两个世界的精华——他们可以看到统一格式的所有内容，或者进入一个专为他们当前工作定制的视图。</p>
<h2><strong>作用于数据</strong></h2>
<p>现在我们把所有的数据都放在一个地方，我们可以做很多令人惊奇的事情！</p>
<p>我们做的第一件事是建立一些基本的跟踪。我们希望能够将行动项分配给特定的人，并查看行动项何时被发现或修复。还有一些误报(例如，kube系统工作负载确实需要root访问权限)，我们开始将其标记为“不会修复”或“按预期工作”。</p>
<p>更好的是，我们开始将标准化的数据推到我们花费时间的不同地方。我们已经将它链接到Datadog，因此团队可以跟踪一段时间的趋势，并在资源使用和正常运行时间等核心指标上覆盖行动项目事件。我们已经开始向Slack发送警报——包括实时的和每日摘要的，以确保团队对任何意想不到的变化保持警惕。沿着这条线，我们正在研究GitHub和吉拉的集成，以确保适当的团队能够修复他们引入的任何问题。</p>
<p>不过，我最感兴趣的是CI/CD集成。目前，我们的代理只是查看集群中已经存在的内容——但是，如果我们能够在问题合并到主代理之前就检测到它们，会怎么样呢？只有部分报告能够在CI环境中运行，但是能够阻止引入新漏洞的PR，或者将操作项追溯到特定的基础架构代码文件，将会节省我们大量的时间、痛苦，最重要的是，降低风险。</p>
<h2>你验证Kubernetes配置的策略是什么？</h2>
<p>如果您已经在审计您的Kubernetes基础设施的安全性、效率和可靠性问题，我们很想听听您正在使用什么工具以及您最关心的问题在哪里。我们正在积极寻求对Fairwinds Insights的反馈，它是免费的！<a href="/coming-soon" rel="noopener">拿到这里。</a></p>
<p><span class="hs-cta-wrapper" id="hs-cta-wrapper-1ccd0525-c794-4194-8aad-fc9663bb9c5a"><span class="hs-cta-node hs-cta-1ccd0525-c794-4194-8aad-fc9663bb9c5a" id="hs-cta-1ccd0525-c794-4194-8aad-fc9663bb9c5a"><a href="https://cta-redirect.hubspot.com/cta/redirect/2184645/1ccd0525-c794-4194-8aad-fc9663bb9c5a"><img class="hs-cta-img" id="hs-cta-img-1ccd0525-c794-4194-8aad-fc9663bb9c5a" src="../Images/34937a5ae51bc0ceb94a21b3fd2382d0.png" alt="Managing Kubernetes Configuration Read the Whitepaper" data-original-src="https://no-cache.hubspot.com/cta/default/2184645/1ccd0525-c794-4194-8aad-fc9663bb9c5a.png"/></a></span>T6】</span></p>
<p> </p></span></div>    
</body>
</html>