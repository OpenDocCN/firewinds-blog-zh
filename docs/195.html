<html>
<head>
<title>How to Kube: KMS Secrets</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>如何Kube: KMS的秘密</h1>
<blockquote>原文：<a href="https://www.fairwinds.com/blog/how-to-kube-kms-secrets#2022-12-12">https://www.fairwinds.com/blog/how-to-kube-kms-secrets#2022-12-12</a></blockquote><div><span id="hs_cos_wrapper_post_body" class="hs_cos_wrapper hs_cos_wrapper_meta_field hs_cos_wrapper_type_rich_text" data-hs-cos-general-type="meta_field" data-hs-cos-type="rich_text"><p>安全性是网络上所有人最关心的问题，尤其是那些使用Kubernetes的人。由于平台上没有任何预先配置的安全设置，因此由您来确保您的节点和集群是安全的。这就是加密在保护您最敏感的数据方面如此重要的原因。</p>

<p>密钥管理服务(KMS)是一种在Kubernetes中加密秘密的廉价方式。使用KMS可以通过控制加密密钥和元数据的机密性、完整性、可用性和来源验证来确保它们受到保护。</p>
<p>请继续阅读如何设置亚马逊提供的密钥管理服务的分步指南。</p>
<h2><strong>构建AWS加密提供程序Docker容器</strong></h2>
<ol>
<li>首先，前往Kubernetes sigs AWS加密提供者存储库。在存储库中，运行“make docker build”来构建docker容器。</li>
<li>用您控制的存储库的名称标记docker容器，并将其推送到该存储库。这确保了docker容器在Kubernetes集群上——特别是主节点上——是可用的。</li>
<li>既然docker容器被推送到存储库，那么您需要创建一个KMS键。</li>
</ol>
<h2><strong>创建一个KMS键</strong></h2>
<ol>
<li>要创建KMS键，请执行以下操作:<ul>
<li>打开AWS控制台，</li>
<li>点击“创建密钥”</li>
<li>选择“对称密钥”</li>
<li>给它起个你能记住的名字</li>
<li>为您的密钥分配默认选项(在此阶段没有必要分配使用权限)。</li>
</ul>
</li>
<li>创建密钥后，在“客户管理的密钥”下找到它，并记录ARN，以便在后面的步骤中使用。</li>
</ol>
<h2><strong>配置节点策略</strong></h2>
<ol>
<li>接下来，您需要创建一个节点策略，允许主节点使用您刚刚创建的密钥进行加密和解密。</li>
<li>将此策略添加到“附加策略”主部分的to kops集群规范中，然后保存文件。</li>
<li>然后，在kops集群规范下，添加“encryptionConfig”并将其设置为true。</li>
<li>最后，您需要添加一个文件资产，在每个主节点上创建一个静态pod。静态pod的清单包括:<ul>
<li>您之前推送的图像名称</li>
<li>您创建的KMS键的ARN</li>
<li>您在其中创建密钥的区域</li>
</ul>
</li>
</ol>
<h2><strong>创建加密配置</strong></h2>
<ol>
<li>接下来，您需要创建一个加密配置yaml文件。该文件指定应该使用AWS加密提供程序在您在static pod中创建的unix套接字上加密机密。</li>
<li>使用“kops create secret”命令将此加密配置创建为kops secret。</li>
<li>既然集群配置已经就绪，并且加密配置被保存为一个秘密，那么是时候替换集群yaml并输入“kops update cluster - yes”了。</li>
<li>Kops随后将指示需要滚动重启主设备。继续执行滚动更新。</li>
</ol>
<p>一旦滚动更新完成，您的集群将被配置为使用密钥管理服务加密所有新创建的秘密！这确保您可以在不暴露主密钥的情况下加密/解密数据，并且您的加密参数总是很强。</p>
<p>关于如何解决Kubernetes集群安全性的更多技巧，<span> </span> <a href="https://www.fairwinds.com/blog/cluster-health-checkup-security">查看这篇博文</a>。</p>
<p><span class="hs-cta-wrapper" id="hs-cta-wrapper-34aa4987-a1f9-438a-a145-d7d82d5c479a"><span class="hs-cta-node hs-cta-34aa4987-a1f9-438a-a145-d7d82d5c479a" id="hs-cta-34aa4987-a1f9-438a-a145-d7d82d5c479a"><a href="https://cta-redirect.hubspot.com/cta/redirect/2184645/34aa4987-a1f9-438a-a145-d7d82d5c479a"><img class="hs-cta-img" id="hs-cta-img-34aa4987-a1f9-438a-a145-d7d82d5c479a" src="../Images/7c86296320eb01b215d8e2755e9c5b9d.png" alt="Use Fairwinds Insights for Free Security, Cost and Developer Enablement In One" data-original-src="https://no-cache.hubspot.com/cta/default/2184645/34aa4987-a1f9-438a-a145-d7d82d5c479a.png"/></a></span>T6】</span></p></span></div>    
</body>
</html>