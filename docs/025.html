<html>
<head>
<title>GitOps Best Practices and the Kubernetes Guardrails You Need to Follow Them</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>GitOps最佳实践和您需要遵循的Kubernetes护栏</h1>
<blockquote>原文：<a href="https://www.fairwinds.com/blog/gitops-best-practices-and-the-kubernetes-guardrails-you-need#2023-01-12">https://www.fairwinds.com/blog/gitops-best-practices-and-the-kubernetes-guardrails-you-need#2023-01-12</a></blockquote><div><span id="hs_cos_wrapper_post_body" class="hs_cos_wrapper hs_cos_wrapper_meta_field hs_cos_wrapper_type_rich_text" data-hs-cos-general-type="meta_field" data-hs-cos-type="rich_text"><p>GitOps是一个大家都在谈论的流行语，这个词是由Weaveworks在2017年创造的。它通过拉请求 方法使用<a href="https://www.weave.works/blog/gitops-operations-by-pull-request" rel="noopener" target="_blank"> <span>操作来定义和管理网络、基础设施、应用程序代码和GitOps管道。GitOps是一种管理由Kubernetes支持的云原生系统的方法。</span></a></p>
<h2>什么是GitOps</h2>
<p>Weaveworks有很多很酷的开源工具，并且已经在Kubernetes领域存在了一段时间。根据Weaveworks网站  上的一个故事<a href="https://www.weave.works/blog/the-history-of-gitops" rel="noopener" target="_blank"> <span> </span> <span> <span>，那里的团队投入了大量精力来改善他们的Kubernetes运营，方法是创建不同的中转区，设置多个可靠性区域，并创建内置监控和安全性。在2016年的某个时候，一名工程师告诉团队，他正在推出一项可能会消除一切的变革。确实如此。但是因为他们拥有Git配置文件中描述的一切，所以他们能够在不到45分钟的时间内恢复他们的系统。</span></span></a></p>
<p>大量工作投入到构建他们的系统中，以使其能够如此快速地恢复，这使他们能够确定使快速恢复成为可能的因素。就在那时，他们提出了GitOps的概念。在开源分布式版本控制系统<a href="https://git-scm.com/"> <span> </span> <span> Git </span> </a>中，他们列出了操作他们的Kubernetes系统需要遵循的原则——该系统基于系统外部存在的系统模型，使整个系统的操作自动化。</p>
<p>GitOps在2018年被全行业采用，2020年11月，亚马逊、Codefresh、GitHub、微软和Weaveworks创建了GitOps工作组，该工作组现在是一个<a href="https://opengitops.dev/about/" rel="noopener" target="_blank"> <span>开放CNCF社区项目</span> </a>。这个小组的目标是定义什么是GitOps，并使它与供应商无关。</p>
<h2>GitOps的四个主要原则</h2>
<ol>
<li aria-level="1">
<p><strong><span>【GitOps】是陈述性的，</span> </strong> <span>意思是强调事实而不是说明。就像Kubernetes一样，你告诉它应该是什么，而不是怎么做。</span></p>
</li>
<li aria-level="1">
<p><strong> <span> GitOps使用Git作为真理源</span> </strong> <span>并且Git真理源是版本化的和不可变的。这是GitOps的好处之一。</span></p>
</li>
<li aria-level="1">
<p><strong> <span> GitOps专注于自动拉取机制。</span> </strong> <span>在我们的标准流程中，您在您的</span> <a href="https://www.fairwinds.com/blog/best-practices-for-implementing-ci-cd-pipelines-in-kubernetes"> <span> </span> <span> CI管道</span> </a> <span>中完成所有的构建和测试；在这里，您可以使用命令将所有内容推送到您的集群。GitOps的哲学是，你的集群应该是</span> <strong> <em> <span>拉动</span> </em> </strong> <span>那些变化本身，你不应该去推动它。</span></p>
</li>
<li aria-level="1">
<p><strong> <span>你的集群不断被调和</span> </strong> <span>。它利用控制循环来关注事情应该如何发展，并使您的集群保持这种状态，这很像Kubernetes本身的内部结构，它完全是关于监视事情状态与您希望事情发展的方式的控制器。</span></p>
</li>
</ol>
<p>在Fairwinds，我们在内部使用GitOps来管理基础设施的附加组件，如cert-manager、ingress-nginx和external-dns。我们使用<a href="https://argo-cd.readthedocs.io/en/stable/" rel="noopener" target="_blank"> ArgoCD </a>，这是市面上少数几种不同的GitOps工具之一。您在集群中部署ArgoCD，并将其配置为监视特定的repo，然后将该repo中的内容与特定的一个或多个集群进行协调。它监视集群，然后协调集群以保持这种状态，这在Git中。</p>
<h2>支持GitOps的工具</h2>
<h3><span>计算者</span></h3>
<p>Fairwinds构建和使用的一个开源工具是<a href="https://reckoner.docs.fairwinds.com/#requirements"> <span> </span> <span> <span>【计算器】</span> </span> </a>，这是一个命令行助手，用于<a href="https://github.com/helm/helm"><span/><span><span>Helm</span></span></a>创建一个声明性语法来管理单个位置的多个发布，并允许从git提交/分支/发布安装图表。</p>
<p>清算者允许你在一个YAML文件中声明一大堆头盔释放。每个版本都是一个舵图，以及相应的值。在YAML文件中，你也可以告诉计算者生成一个ArgoCD应用程序清单。ArgoCD应用程序中可用的大多数选项，如autosync，在Reckoner中也可用。</p>
<p>然后，Reckoner在manifest目录中创建一个文件夹结构，每个应用程序有一个文件夹，还有一个包含所有ArgoCD应用程序的文件夹。然后，您可以创建一个应用程序的应用程序，指向该文件夹并同步应用程序。因此，您唯一需要手动管理的是定义您的应用程序的单个ArgoCD应用程序清单。</p>
<p>当您创建一个新的应用程序时，它会同步到ArgoCD中，然后继续同步该应用程序。模板化到每个文件夹中的清单是应该应用到集群的声明性状态，因此当您对其进行更改时，您可以在Git pull/merge请求中看到更改。通过模板化这些清单，您可以在更改进入集群之前获得将要发生的完全不同的确切更改。这种增加的透明度为您提供了您需要的所有信息，而不是您必须在舵图或ArgoCD舵应用程序中搜索的更有限的信息。</p>
<p>清单还允许您对CI/CD系统中的YAML进行静态分析和运行CI/CD检查。您还应该创建一个检查来验证计算器模板是否被正确执行。它验证没有Git更改，也没有手动修改YAML。这支持GitOps原则，即确保只有一个源，其中没有未跟踪的更改。</p>
<h3>立方结构改革</h3>
<p>您还需要运行一个<a href="https://github.com/yannh/kubeconform" rel="noopener" target="_blank"><span/><span>kube conform</span></a>来检查您的模板化清单，因为虽然Helm图表可能会产生一些YAML，但YAML可能没有根据Kubernetes的模式进行验证。Helm不会在Helm模板上这样做，因为它无权访问集群。Kubeconform是一个Kubernetes清单验证器；它获取所有清单，并根据Kubernetes存储库中的模式对它们进行验证。kubeconform可以做的另一件事是创建一个JUnit文件，您可以将它发送到您的CI/CD系统，让它显示您的每个单独测试的结果。</p>
<h3><span>北极星</span></h3>
<p>采用GitOps时，重要的是将正确的护栏放置到位，并遵循Kubernetes的最佳实践，以确保您构建的安全性和稳定性。<a href="https://www.fairwinds.com/polaris"> <span>北极星</span> </a>帮你做到。这是另一个可以在CI/CD中运行的Fairwinds开源工具。它检查<a href="https://www.fairwinds.com/blog/intro-kubernetes-best-practices"> <span> Kubernetes最佳实践</span> </a>，特别是与安全性、效率和可靠性相关的最佳实践。Polaris包括30多种内置配置策略，并将验证它们，甚至修复Kubernetes资源，以确保遵循配置最佳实践。Polaris检查整个存储库和清单集的配置问题，这有助于您与GitOps最佳实践保持一致。</p>
<h2>费尔温德见解</h2>
<p>您可以使用<a href="https://www.fairwinds.com/insights"><span/><span>fair winds Insights</span></a>获得完整的存储库报告，该报告将在一个地方向您显示清单目录中发现的所有问题，而不是为每个工具编写单独的检查。它包括:</p>
<ul>
<li aria-level="1">
<p><span>一份</span> <span> <a href="https://github.com/aquasecurity/trivyhttps:/github.com/aquasecurity/trivy" rel="noopener" target="_blank">琐碎的</a> </span> <span>报告，显示其发现:漏洞、错误配置、秘密、容器中的软件材料清单、Kubernetes、代码库、云等等。</span></p>
</li>
<li aria-level="1">
<p>一份显示配置问题的报告。</p>
</li>
<li aria-level="1">
<p><span>A</span><span><a href="https://pluto.docs.fairwinds.com/">Pluto</a></span><span>关于代码仓库和Helm版本中弃用的Kubernetes API版本的报告。</span></p>
</li>
<li aria-level="1">
<p><span>An</span><a href="https://www.openpolicyagent.org/" rel="noopener" target="_blank"><span><span>Open Policy Agent(OPA</span>)</span></a><span>报告，这样您就可以通过减压阀应用您自己的策略，将它们应用到您的YAML，并将其添加到您的支票中。</span></p>
</li>
</ul>
<p>您可以打开“自动扫描细节”来自动查看这些报告，并根据调查结果创建票据。您还可以使用吉拉集成为发现创建标签，并将它们分配给需要修复它们的团队。Fairwinds Insights为多达20个节点、两个群集和一个存储库的环境提供了一个免费层 。</p>
<h2>GitOps +立方结构护栏</h2>
<p>通过遵循这些GitOps最佳实践，并使用工具来符合Kubernetes最佳实践并实现guardrails，您可以确保您的GitOps流程是安全的、可靠的和可维护的。这将帮助您保持Kubernetes环境按预期运行，同时确保所做的任何更改都是有效的，不会导致意外问题。</p>
<p>观看网络研讨会，更好地了解GitOps如何工作，以及这些开源工具如何帮助您实现符合GitOps最佳实践的<a href="https://www.fairwinds.com/kube-clinic-gitops-12-07-reg"> <span> </span> <span> <span> Kubernetes护栏</span> </span> </a>。</p>
<p><span class="hs-cta-wrapper" id="hs-cta-wrapper-34aa4987-a1f9-438a-a145-d7d82d5c479a"><span class="hs-cta-node hs-cta-34aa4987-a1f9-438a-a145-d7d82d5c479a" id="hs-cta-34aa4987-a1f9-438a-a145-d7d82d5c479a"><a href="https://cta-redirect.hubspot.com/cta/redirect/2184645/34aa4987-a1f9-438a-a145-d7d82d5c479a"><img class="hs-cta-img" id="hs-cta-img-34aa4987-a1f9-438a-a145-d7d82d5c479a" src="../Images/7c86296320eb01b215d8e2755e9c5b9d.png" alt="Use Fairwinds Insights for Free Security, Cost and Developer Enablement In One" data-original-src="https://no-cache.hubspot.com/cta/default/2184645/34aa4987-a1f9-438a-a145-d7d82d5c479a.png"/></a></span>T6】</span></p></span></div>    
</body>
</html>