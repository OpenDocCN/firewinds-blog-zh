<html>
<head>
<title>Demo: Monitoring Kubernetes Workloads with Astro</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>演示:用Astro监控Kubernetes工作负载</h1>
<blockquote>原文：<a href="https://www.fairwinds.com/blog/demo-monitoring-kubernetes-workloads-astro#2020-09-16">https://www.fairwinds.com/blog/demo-monitoring-kubernetes-workloads-astro#2020-09-16</a></blockquote><div><span id="hs_cos_wrapper_post_body" class="hs_cos_wrapper hs_cos_wrapper_meta_field hs_cos_wrapper_type_rich_text" data-hs-cos-general-type="meta_field" data-hs-cos-type="rich_text"><p>我是Fairwinds的现场可靠性工程师，我们提供软件和服务产品，帮助我们的客户在Kubernetes的世界中取得成功。在我们的最高接触产品中，我们将为您运行集群，并全天候监控该基础架构。在与如此多具有不同需求的集群和客户合作时，有必要使用工具来提高我们(和我们的客户)日常工作的效率。我们创建的许多软件都是开源的，以回馈我们经常利用的开源社区。Astro 是这些开源工具中的一个，也是今天的焦点。</p>

<p>首先，我想告诉你一点我职业生涯中的监测历程。10年前，我的第一份工作是在一家大型公司，使用裸机服务器和一些虚拟机，但虚拟机主要用于开发和QA。所做的大多数监控都是针对裸机的。在这一点上，我在监控和警报方面的经验是围绕着静态监控那些不经常改变的机器。我们谈论的是其中一些机器和应用程序的数百小时正常运行时间。</p>
<p>从裸机主机到容器和Kubernetes世界的转变要求我们重新思考一些关于监控的事情。在传统的裸机环境中，需要监控的机器数量通常是已知的，每个主机上的进程数量有限。轻松点。您只需在配置计算机时设置一次监视器，并从此依赖它们。</p>
<p>使用Kubernetes时，开发团队可以根据需要创建和销毁服务，这意味着您需要监控数量未知的服务。当使用手动定义的传统静态监控时，这就留下了一些需要改进的地方。根据应用程序的SLA和SLO，您可能希望在应用程序行为不当时收到警报。另一方面，一旦服务从集群中删除，您就不需要继续监视它。当然，根据您或您的组织如何管理部署，情况可能并非如此，但不管怎样，让软件来管理这个过程更容易。</p>
<h2><strong>使用Astro监控Kubernetes工作负载</strong></h2>
<p>Datadog的服务非常棒，为我们这些Kubernetes运营商免去了很多日常生活中的辛劳。在安装了datadog-agent之后，当涉及到度量收集时，大多数事情“只是工作”。我们构建Astro来补充Datadog服务，以便在Kubernetes的动态世界中自动监控工作负载。Astro是一个在Kubernetes集群中运行的工作负载，它将根据工作负载上的注释或包含多个工作负载的名称空间创建一组已定义的监视器。Astro提供了三个关键要素来大大简化显示器管理:</p>
<ol type="1">
<li>针对Kubernetes中运行的工作负载自动管理Datadog监视器的生命周期:给定配置参数，该实用程序将自动管理Kubernetes集群中所有相关对象的已定义监视器。随着对象的改变，监视器被更新以反映该状态。</li>
<li>逻辑绑定对象之间的相关性:Astro能够管理给定名称空间内所有对象的监视器。这确保了显示器配置之间的更大一致性。</li>
<li>将Kubernetes对象中的值模板化到托管监视器中:托管Kubernetes对象中的任何数据都可以插入到托管监视器中。这使得警报信息更加丰富，并且可以使监视器更加针对具体的环境。</li>
</ol>
<h2><strong>观看Astro的演示</strong></h2>

<h3>副本</h3>
<p>在这个演示中，我已经有了Astro running，它是用我们提供的舵图安装的。我们在我的顶部窗格中跟踪Astro的日志，并在Datadog前端显示监视器。我们在这个演示中配置了Astro，为任何部署创建一组监视器，注释为astro/owner = astro。如果您愿意，可以将这个键值组合配置为其他值。您可以在这里看到，我已经将这个注释添加到我们的nginx部署中。我们会看到一条日志消息，提示应该创建监视器。如果我们刷新Datadog前端，我们可以看到这是真的！现在让我们删除注释，并验证Astro删除了监视器。</p>
<p>另一个值得注意的特性是绑定监视器的概念。在绑定监视器中，配置一组“绑定的”资源类型，比如部署，然后将配置的注释应用到名称空间，在本例中是astro/admin-bound = astro。一旦应用到名称空间，任何与该名称空间中的绑定类型匹配的资源都将获得一组监视器。这使您能够灵活地监控给定名称空间中的每个部署。目前，Deployment是添加DaemonSets和StatefulSets计划中唯一可用的资源类型。</p>
<p>如果我们从名称空间中删除注释，监视器就会消失</p>
<p>Astro项目还很年轻，还在成长，社区也在随之成长。我们希望在我们的<a href="http://fairwindscommunity.slack.com">社区slack </a>中看到你，甚至可能为Astro开一个PR来帮助我们使这个项目尽可能有用。</p>
<p><span class="hs-cta-wrapper" id="hs-cta-wrapper-41811205-0655-4320-83cf-dd295b586d2f"><span class="hs-cta-node hs-cta-41811205-0655-4320-83cf-dd295b586d2f" id="hs-cta-41811205-0655-4320-83cf-dd295b586d2f"><a href="https://cta-redirect.hubspot.com/cta/redirect/2184645/41811205-0655-4320-83cf-dd295b586d2f"><img class="hs-cta-img" id="hs-cta-img-41811205-0655-4320-83cf-dd295b586d2f" src="../Images/eb0e55f0923f5ff4b7db67c467359b19.png" alt="Kubernetes Clinics: Community focused tech deep dives" data-original-src="https://no-cache.hubspot.com/cta/default/2184645/41811205-0655-4320-83cf-dd295b586d2f.png"/></a></span>T6】</span></p></span></div>    
</body>
</html>